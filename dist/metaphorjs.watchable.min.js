(function(){var A=function(){var a=["0","0","0"];return function(){for(var c=a.length,b;c;){c--;b=a[c].charCodeAt(0);if(57==b)return a[c]="A",a.join("");if(90==b)a[c]="0";else return a[c]=String.fromCharCode(b+1),a.join("")}a.unshift("0");return a.join("")}}(),J=Object.prototype.toString,p=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(c){if(!c){if(null===
c)return 6;if(void 0===c)return 7}var b=a[J.call(c)];return void 0===b?-1:1==b&&isNaN(c)?8:b}}(),s=function(a){return"object"==typeof a&&5===p(a)},t=function(a){return"function"==typeof a},u=function(a){return"string"==typeof a||a===""+a},r=function(){return String.prototype.trim?function(a){return u(a)?a.trim():a}:function(a){return u(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),v=function(){},w=Array.prototype.slice,B=function(a){return a===window||a&&a.document&&a.location&&a.alert&&a.setInterval},
E=function(){var a=function(c,b){if(c===b)return!0;if(null===c||null===b)return!1;if(c!==c&&b!==b)return!0;var d=typeof c,e;if(d==typeof b&&"object"==d)if(s(c)){if(!s(b))return!1;if((d=c.length)==b.length){for(e=0;e<d;e++)if(!a(c[e],b[e]))return!1;return!0}}else{if(10===p(c))return 10===p(b)&&c.getTime()==b.getTime();if(9===p(c)&&9===p(b))return c.toString()==b.toString();if(B(c)||B(b)||s(b))return!1;d={};for(e in c)if("$"!=e.charAt(0)&&!t(c[e])){if(!a(c[e],b[e]))return!1;d[e]=!0}for(e in b)if(!d.hasOwnProperty(e)&&
"$"!=e.charAt(0)&&void 0!==b[e]&&!t(b[e]))return!1;return!0}return!1};return a}(),F=function(){var a=function(c,b){if(B(c))throw Error("Cannot copy window object");if(b){if(c===b)throw Error("Objects are identical");if(s(c))for(var d=b.length=0,e=c.length;d<e;d++)b.push(a(c[d]));else{for(d in b)delete b[d];for(d in c)c.hasOwnProperty(d)&&("$"==d.charAt(0)||t(c[d])?b[d]=c[d]:b[d]=a(c[d]))}}else(b=c)&&(s(c)?b=a(c,[]):10===p(c)?b=new Date(c.getTime()):9===p(c)?b=new RegExp(c.source):"object"!=typeof c||
3!==p(c)||c.nodeType||(b=a(c,{})));return b};return a}(),K=function(a,c,b,d){setTimeout(function(){a.apply(c,b||[])},d||0)},y=function(a){var c=a.stack||Error().stack;if("undefined"!=typeof console&&console.log)K(function(){console.log(a);c&&console.log(c)});else throw a;},C=function(a){a=p(a);return 3>a&&-1<a},L=Function.prototype.bind?function(a,c){return a.bind(c)}:function(a,c){return function(){return a.apply(c,arguments)}},G=function(){this.events={}};G.prototype={createEvent:function(a,c){a=
a.toLowerCase();var b=this.events;b[a]||(b[a]=new D(a,c));return b[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,c,b,d){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new D(a));return e[a].on(c,b,d)},once:function(a,c,b,d){d=d||{};d.limit=1;return this.on(a,c,b,d)},un:function(a,c,b){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(c,b)},hasListener:function(a,c,b){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(c,b):!1},removeAllListeners:function(a){var c=
this.events;c[a]&&c[a].removeAllListeners()},trigger:function(){var a=arguments[0],c=this.events,a=a.toLowerCase();if(!c[a])return null;a=c[a];return a.trigger.apply(a,w.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var c=this.events;c[a]&&c[a].suspend()},suspendAllEvents:function(){var a=this.events,c;for(c in a)a[c].suspend()},resumeEvent:function(a){a=a.toLowerCase();var c=this.events;c[a]&&c[a].resume()},resumeAllEvents:function(){var a=this.events,c;for(c in a)a[c].resume()},
destroyEvent:function(a){var c=this.events;c[a]&&(c[a].removeAllListeners(),c[a].destroy(),delete c[a])},destroy:function(a){var c=this.events;if(a)a=a.toLowerCase(),c[a]&&(c[a].destroy(),delete c[a]);else{for(var b in c)c[b].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),c={},b,d=-1,e=a.length;++d<e;b=a[d],c[b]=L(this[b],
this));this.api=c}return this.api}};var D=function(a,c){this.name=a;this.listeners=[];this.map={};this.hash=A();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===c?null:c};D.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,c,b){if(!a)return null;c=c||null;b=b||{};var d=this.uni,e=c||a;if(e[d]&&!b.allowDupes)return null;var m=++this.lid,g=b.first||!1;e[d]=m;a={fn:a,scope:c,uniScope:e,id:m,called:0,limit:b.limit||
0,start:b.start||1,count:0,append:b.append,prepend:b.prepend};g?this.listeners.unshift(a):this.listeners.push(a);this.map[m]=a;return m},once:function(a,c,b){b=b||{};b.once=!0;return this.on(a,c,b)},un:function(a,c){var b=-1,d=this.uni,e=this.listeners,m;m=a==parseInt(a)?a:(c||a)[d];if(!m)return!1;for(var g=0,x=e.length;g<x;g++)if(e[g].id==m){b=g;delete e[g].uniScope[d];break}if(-1==b)return!1;e.splice(b,1);delete this.map[m];return!0},hasListener:function(a,c){var b=this.listeners,d;if(a){c=c||a;
d=t(a)?c[this.uni]:a;if(!d)return!1;for(var e=0,m=b.length;e<m;e++)if(b[e].id==d)return!0;return!1}return 0<b.length},removeAllListeners:function(){var a=this.listeners,c=this.uni,b,d;b=0;for(d=a.length;b<d;b++)delete a[b].uniScope[c];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,c){var b;a.append||a.prepend?(b=w.call(c),a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=b.concat(a.append))):b=c;return b},trigger:function(){var a=
this.listeners,c=this.returnResult;if(this.suspended||0==a.length)return null;for(var b="all"==c?[]:null,d,e,a="first"==c?[a[0]]:w.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==c&&b.push(e);if("first"==c)return e;"last"==c&&(b=e);if(!1==c&&!1===e)break}if(c)return b}};var z=function(){var a=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,c=Function,b=function(a,c,g,b){for(;g&&!g.$isRoot;)if(g=
g.$parent)try{return 4==arguments.length?c.call(null,g,b,v,c):c.call(null,g,v,c)}catch(x){}null!==a&&y(a)},d=function(a,c){return function(){var g=w.call(arguments);g.push(b);g.push(a);g=a.apply(null,g);return c&&(void 0===g||"number"==typeof g&&isNaN(g))?(g=w.call(arguments),g.unshift(a),g.unshift(null),b.apply(null,g)):g}},e={},m=0,g={},x=0,q={},H=0,n=function(){1E3<=m&&(e={});1E3<=x&&(g={});1E3<=H&&(q={})};return{createGetter:function(g){try{return e[g]?e[g]:(m++,e[g]=d(new c("____","$$interceptor",
"$$itself","".concat("try {","return ",g.replace(a,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }")),!0))}catch(b){return y(b),v}},createSetter:function(b){try{if(!g[b]){x++;var q=b.replace(a,"$1____.$3");return g[b]=d(new c("____","$$$$","$$interceptor","$$itself","".concat("try {",q," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return g[b]}catch(f){return y(f),v}},createFunc:function(g){try{return q[g]?
q[g]:(H++,q[g]=d(new c("____","$$interceptor","$$itself","".concat("try {",g.replace(a,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(b){return y(b),v}},resetCache:n,enableResetCacheInterval:function(){setTimeout(n,1E4)}}}(),I=z.createGetter,M=z.createSetter,z=function(){var a=function(a){if(!u(a))return!0;var c=a.substr(0,1),b=a.length-1;return'"'!=c&&"'"!=c||a.indexOf(c,1)!=b?!1:a.substring(1,b)},c,b=function(g,b,q,d,n,k){c||(c=new G);var h=
A(),f;k&&(this.namespace=k,this.nsGet=k.get);this.origCode=b;u(b)||(d=q,q=b,b=null,f="object");u(g)&&(d=q,q=b,b=g,g=null);b&&g&&(f=g.hasOwnProperty(b)?"attr":"expr");b&&!g&&(f="expr");if(q)c.on(h,q,d||this,{append:[n],allowDupes:!0});if("expr"==f){b=this._processInputPipes(b,g);b=this._processPipes(b,g);if(this.inputPipes||this.pipes)b=e(g,b),f=g.hasOwnProperty(b)?"attr":"expr";if(this.staticValue=a(b))f="static"}this.userData=n;this.code=b;this.id=h;this.type=f;this.obj=g;"expr"==f&&(this.getterFn=
I(b));this.curr=this._getValue();this.currCopy=C(this.curr)?this.curr:F(this.curr)};b.prototype={namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,_indexArrayItems:function(a){var c="$$"+this.id,b,d,n;if(a)for(b=0,d=a.length;b<d;b++)n=a[b],!n||C(n)||n[c]||(n[c]=A())},_processInputPipes:function(a,c){if(-1==a.indexOf(">>"))return a;
for(var b=0,d=a.length,n=[],e,h,f,l=a;b<d&&-1!=(e=a.indexOf(">>",b));)h=a.charAt(e-1),f=a.charAt(e+2),"\\"!=h&&"'"!=h&&'"'!=h&&"'"!=f&&'"'!=f&&(b=r(a.substring(b,e)).split(":"),l=a.substr(e+2),this._addPipe(n,b,c,this.onInputParamChange)),b=e+2;n.length&&(this.inputPipes=n);return r(l)},_addPipe:function(a,c,b,e){var n=c.shift(),k=null,h=[],f;this.nsGet&&(k=this.nsGet("filter."+n,!0));k||(k=window[n]||b[n]);if(t(k)){n=-1;for(f=c.length;++n<f;h.push(d(b,c[n],e,this,null,this.namespace)));a.push([k,
c,h])}},_processPipes:function(a,c){if(-1==a.indexOf("|"))return a;for(var b=0,d=a.length,e=[],k,h,f,l=!1,m=a;b<d;)if(-1!=(k=a.indexOf("|",b)))h=a.charAt(k-1),f=a.charAt(k+1),"|"!=h&&"'"!=h&&'"'!=h&&"|"!=f&&"'"!=f&&'"'!=f&&(l?(b=r(a.substring(b,k)).split(":"),this._addPipe(e,b,c)):(l=!0,m=r(a.substring(0,k)))),b=k+1;else{l&&(b=r(a.substr(b)).split(":"),this._addPipe(e,b,c,this.onPipeParamChange));break}e.length&&(this.pipes=e);return m},_getValue:function(){var a;switch(this.type){case "static":a=
this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":a=this.obj}s(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,b){if(b){var c,d,e,k=b.length,h=this.obj,f,l;for(c=0;c<k;c++){e=b[c][1];d=[];f=-1;for(l=e.length;++f<l;d.push(m(e[f],h)));d.unshift(h);d.unshift(a);a=b[c][0].apply(null,d)}}return a},subscribe:function(a,b,d){c.on(this.id,
a,b,d)},unsubscribe:function(a,b){return c.un(this.id,a,b)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,b){var c;b=b||this._getValue();var d=b,e=a.length,k=d.length,h=Array(e+1);c=Array(e+1);var f,l,m,p=0;if(e==k&&0==e)c=[];else{for(f=0;f<=e;f++)h[f]=Array(k+1),c[f]=
Array(k+1),h[f][0]=f,c[f][0]="D";for(f=0;f<=k;f++)h[0][f]=f,c[0][f]="I";for(f=1;f<=e;f++)for(l=1;l<=k;l++)m=E(a[f-1],d[l-1])?0:1,h[f][l-1]<h[f-1][l]&&h[f][l-1]<h[f-1][l-1]+m?(h[f][l]=h[f][l-1]+1,c[f][l]="I"):h[f-1][l]<h[f-1][l-1]+m?(h[f][l]=h[f-1][l]+1,c[f][l]="D"):(h[f][l]=h[f-1][l-1]+m,c[f][l]=1==m?"R":"-");d=[];f=e;l=k;do e=c[f][l],d.push(e),"-"!=e&&p++,"R"==e||"-"==e?(f--,l--):"D"==e?f--:l--;while(0!=f||0!=l);c=d.reverse()}return c},getMovePrescription:function(a,c,b){var d=b=b||this._getValue();
b=this.getPrescription(a,b);var e=[],k,h,f,l={},m,p;k=0;for(h=a.length;k<h;k++)(f=c(a[k]))&&(l[f]=k);m=0;var r={};k=0;for(h=b.length;k<h;k++)a=b[k],"D"!=a&&(f=c(d[m]),void 0!=f&&!0!==r[f]&&void 0!==(p=l[f])?(e.push(p),r[f]=!0):e.push(a),m++);return e},setValue:function(a){var b=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);"attr"==b?this.obj[this.code]=a:"expr"==b?(this.setterFn||(this.setterFn=M(this.code)),this.setterFn(this.obj,a)):"object"==b&&(this.obj=a)},onInputParamChange:function(){this.setValue(this.lastSetValue)},
onPipeParamChange:function(){this.check()},check:function(){var a=this._getValue(),b=this.currCopy;return E(b,a)?!1:(this.curr=a,this.prev=b,this.currCopy=C(a)?a:F(a),c.trigger(this.id,a,b),!0)},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,
b){var d=this.id;a&&c.un(d,a,b);return c.hasListener(d)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,d,e,n,k,h;this.itv&&this.clearInterval();if(a)for(d=-1,e=a.length;++d<e;)for(h=a[d][2],n=-1,k=h.length;++n<k;)h[n].unsubscribeAndDestroy(this.check,this);if(b)for(d=-1,e=b.length;++d<e;)for(h=b[d][2],n=-1,k=h.length;++n<k;)h[n].unsubscribeAndDestroy(this.onInputParamChange,this);this.obj&&delete this.obj.$$watchers[this.origCode];delete this.id;delete this.curr;delete this.prev;
delete this.unfiltered;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;delete this.namespace;delete this.nsGet;c.destroyEvent(this.id)}};var d=function(a,c,d,m,n,k){c=e(a,r(c));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,c=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?c++:"$"==a.charAt(0)&&this[a]instanceof b&&this[a].check()&&
c++;return c},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof b)this[a].destroy(),delete this[a]}}),a.$$watchers[c]?a.$$watchers[c].subscribe(d,m,{append:[n],allowDupes:!0}):a.$$watchers[c]=new b(a,c,d,m,n,k),a.$$watchers[c]):new b(a,c,d,m,n,k)},e=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},m=function(b,c){var d;return(d=a(b))?d:I(b)(c)};b.create=d;b.unsubscribeAndDestroy=function(a,
b,c,d){b=r(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&delete a[b]};b.normalizeExpr=e;b.eval=m;return b}();MetaphorJs.lib.Watchable=z;"undefined"!=typeof global?global.MetaphorJs=MetaphorJs:window.MetaphorJs=MetaphorJs})();
