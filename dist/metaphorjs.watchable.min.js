'use strict';(function(){function s(a){return"object"==typeof a&&5===p(a)}function u(a){return"function"==typeof a}function v(a){return"string"==typeof a||a===""+a}function F(a){return a===window||a&&a.document&&a.location&&a.alert&&a.setInterval}function x(a){return"object"==typeof a&&3===p(a)&&!a.nodeType&&a.constructor===Object}function G(a){return!0===a||!1===a}function z(a){a=p(a);return 3>a&&-1<a}function L(){return!1}function M(a,b,c,d){setTimeout(function(){a.apply(b,c||[])},d||0)}function A(a){var b=
a.stack||Error().stack;if("undefined"!=typeof console&&console.log)M(function(){console.log(a);b&&console.log(b)});else throw a;}function B(){}var C=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),N=Object.prototype.toString,p=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,
"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[N.call(b)];return void 0===c?-1:1==c&&isNaN(b)?8:c}}(),r=function(){return String.prototype.trim?function(a){return v(a)?a.trim():a}:function(a){return v(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),w=Array.prototype.slice,H=function(){return function b(c,d){if(c===d)return!0;if(null===c||null===d)return!1;if(c!==
c&&d!==d)return!0;var e=typeof c,f;if(e==typeof d&&"object"==e)if(s(c)){if(!s(d))return!1;if((e=c.length)==d.length){for(f=0;f<e;f++)if(!b(c[f],d[f]))return!1;return!0}}else{if(10===p(c))return 10===p(d)&&c.getTime()==d.getTime();if(9===p(c)&&9===p(d))return c.toString()==d.toString();if(F(c)||F(d)||s(d))return!1;e={};for(f in c)if("$"!=f.charAt(0)&&!u(c[f])){if(!b(c[f],d[f]))return!1;e[f]=!0}for(f in d)if(!e.hasOwnProperty(f)&&"$"!=f.charAt(0)&&void 0!==d[f]&&!u(d[f]))return!1;return!0}return!1}}(),
I=function(){var a="undefined"!=typeof window?window:null,b="undefined"!=typeof global?global:null;return function d(e,f){if(a&&e===a)throw Error("Cannot copy window object");if(b&&e===b)throw Error("Cannot copy global object");if(f){if(e===f)throw Error("Objects are identical");if(s(e))for(var g=f.length=0,m=e.length;g<m;g++)f.push(d(e[g]));else{for(g in f)delete f[g];for(g in e)e.hasOwnProperty(g)&&("$"==g.charAt(0)||u(e[g])?f[g]=e[g]:f[g]=d(e[g]))}}else(f=e)&&(s(e)?f=d(e,[]):10===p(e)?f=new Date(e.getTime()):
9===p(e)?f=new RegExp(e.source):x(e)&&(f=d(e,{})));return f}}(),O=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},D=function(){return function b(){var c=!1,d=!1,e=w.call(arguments),f=e.shift(),g,m,l;G(e[e.length-1])&&(c=e.pop());G(e[e.length-1])&&(d=c,c=e.pop());for(;e.length;)if(g=e.shift())for(m in g)if(g.hasOwnProperty(m)&&void 0!==(l=g[m]))if(d)if(f[m]&&x(f[m])&&x(l))b(f[m],l,c,d);else{if(!0===c||void 0==f[m])x(l)?(f[m]={},
b(f[m],l,c,!0)):f[m]=l}else if(!0===c||void 0==f[m])f[m]=l;return f}}(),P=function(){var a=Object.prototype.toString,b=Function.prototype.toString,c=/^\[object .+?Constructor\]$/,d=RegExp("^"+String(a).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return function(e){var f=typeof e;return"function"==f?!("prototype"in e)||d.test(b.call(e)):e&&"object"==f&&c.test(a.call(e))||!1}}(),J=function(){this.events={}};D(J.prototype,{createEvent:function(a,
b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new E(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new E(a));return e[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=
this.events;b[a]&&b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,w.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},
destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,d=-1,e=a.length;++d<e;c=a[d],b[c]=O(this[c],
this));this.api=b}return this.api}},!0,!1);var E=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=C();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=void 0===b?null:b};D(E.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,e=b||a;if(e[d]&&!c.allowDupes)return null;var f=++this.lid,g=c.first||!1;e[d]=f;a={fn:a,context:b,uniContext:e,id:f,
called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};g?this.listeners.unshift(a):this.listeners.push(a);this.map[f]=a;return f},once:function(a,b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,e=this.listeners,f;f=a==parseInt(a)?a:(b||a)[d];if(!f)return!1;for(var g=0,m=e.length;g<m;g++)if(e[g].id==f){c=g;delete e[g].uniContext[d];break}if(-1==c)return!1;e.splice(c,1);delete this.map[f];return!0},hasListener:function(a,b){var c=this.listeners,
d;if(a){b=b||a;d=u(a)?b[this.uni]:a;if(!d)return!1;for(var e=0,f=c.length;e<f;e++)if(c[e].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c,d;c=0;for(d=a.length;c<d;c++)delete a[c].uniContext[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=w.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},
trigger:function(){var a=this.listeners,b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==b?[]:null,d,e,a="first"==b?[a[0]]:w.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.context,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&c.push(e);if("first"==b)return e;"last"==b&&(c=e);if(!1==b&&!1===e)break}if(b)return c}},!0,!1);var y=function(){var a=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,b=Function,
c=function(a,m){return function(l){var b=w.call(arguments),c;b.push(null);b.push(a);if(m){for(c=a.apply(null,b);(void 0===c||"number"==typeof c&&isNaN(c))&&!l.$isRoot;)l=l.$parent,b[0]=l,c=a.apply(null,b);return c}return a.apply(null,b)}},d={},e=0,f={},g=0,m={},l=0,q=function(){1E3<=e&&(d={});1E3<=g&&(f={});1E3<=l&&(m={})};return{createGetter:function(m){try{return d[m]?d[m]:(e++,d[m]=c(new b("____","$$interceptor","$$itself","".concat("try {","return ",m.replace(a,"$1____.$3"),";} catch (thrownError) { return undefined; }")),
!0))}catch(l){return A(l),B}},createSetter:function(m){try{if(!f[m]){g++;var l=m.replace(a,"$1____.$3");return f[m]=c(new b("____","$$$$","$$interceptor","$$itself","".concat("try {",l," = $$$$",";} catch (thrownError) { return undefined; }")))}return f[m]}catch(q){return A(q),B}},createFunc:function(q){try{return m[q]?m[q]:(l++,m[q]=c(new b("____","$$interceptor","$$itself","".concat("try {",q.replace(a,"$1____.$3"),";} catch (thrownError) { return undefined; }"))))}catch(d){return A(d),B}},resetCache:q,
enableResetCacheInterval:function(){setTimeout(q,1E4)}}}(),K=y.createGetter,Q=y.createSetter,y=function(){var a=Object.observe&&P(Object.observe),b=function(a){if(!v(a))return!0;var l=a.substr(0,1),b=a.length-1;return'"'!=l&&"'"!=l||a.indexOf(l,1)!=b?!1:a.substring(1,b)},c,d=function(a,l,q,d,e,t){c||(c=new J);var n=C(),k;t&&(this.namespace=t,this.nsGet=t.get);this.origCode=l;v(l)||(d=q,q=l,l=null,k="object");v(a)&&(d=q,q=l,l=a,a=null);l&&a&&(k=a.hasOwnProperty(l)?"attr":"expr");l&&!a&&(k="expr");
if(q)c.on(n,q,d||this,{append:[e],allowDupes:!0});if("expr"==k){l=this._processInputPipes(l,a);l=this._processPipes(l,a);if(this.inputPipes||this.pipes)l=f(a,l),k=a.hasOwnProperty(l)?"attr":"expr";if(this.staticValue=b(l))k="static"}this.userData=e;this.code=l;this.id=n;this.type=k;this.obj=a;"expr"==k&&(this.getterFn=K(l));"static"!=k||this.pipes?(this.curr=this.curr||this._getValue(),this.currCopy=z(this.curr)?this.curr:I(this.curr)):(this.check=L,this.curr=this.prev=this.staticValue)};D(d.prototype,
{namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,obsrvDelegate:null,obsrvChanged:!1,_indexArrayItems:function(a){var l="$$"+this.id,b,c,d;if(a)for(b=0,c=a.length;b<c;b++)d=a[b],!d||z(d)||d[l]||(d[l]=C())},_processInputPipes:function(a,b){if(-1==a.indexOf(">>"))return a;for(var c=0,d=a.length,e=[],f,n,k,h=a;c<
d&&-1!=(f=a.indexOf(">>",c));)n=a.charAt(f-1),k=a.charAt(f+2),"\\"!=n&&"'"!=n&&'"'!=n&&"'"!=k&&'"'!=k&&(c=r(a.substring(c,f)).split(":"),h=a.substr(f+2),this._addPipe(e,c,b,this.onInputParamChange)),c=f+2;e.length&&(this.inputPipes=e);return r(h)},_addPipe:function(a,b,c,d){var f=b.shift(),t=null,n=[],k;this.nsGet&&(t=this.nsGet("filter."+f,!0));t||(t=window[f]||c[f]);if(u(t)){f=-1;for(k=b.length;++f<k;n.push(e(c,b[f],d,this,null,this.namespace)));a.push([t,b,n])}},_processPipes:function(a,b){if(-1==
a.indexOf("|"))return a;for(var c=0,d=a.length,e=[],f,n,k,h=!1,g=a;c<d;)if(-1!=(f=a.indexOf("|",c)))n=a.charAt(f-1),k=a.charAt(f+1),"|"!=n&&"'"!=n&&'"'!=n&&"|"!=k&&"'"!=k&&'"'!=k&&(h?(c=r(a.substring(c,f)).split(":"),this._addPipe(e,c,b)):(h=!0,g=r(a.substring(0,f)))),c=f+1;else{h&&(c=r(a.substr(c)).split(":"),this._addPipe(e,c,b,this.onPipeParamChange));break}e.length&&(this.pipes=e);return g},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=this.obj[this.code];
break;case "expr":a=this.getterFn(this.obj);break;case "object":a=this.obj}s(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,c){if(c){var b,d,e,f=c.length,n=this.obj,k,h;for(b=0;b<f;b++){e=c[b][1];d=[];k=-1;for(h=e.length;++k<h;d.push(g(e[k],n)));d.unshift(n);d.unshift(a);a=c[b][0].apply(null,d)}}return a},subscribe:function(a,b,d){c.on(this.id,a,b,d)},unsubscribe:function(a,b){return c.un(this.id,
a,b)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,b){var c;b=b||this._getValue();var d=a||[],e=b||[],f=d.length,n=e.length,k=Array(f+1);c=Array(f+1);var h,g,p,r=0;if(f==n&&0==f)c=[];else{for(h=0;h<=f;h++)k[h]=Array(n+1),c[h]=Array(n+1),k[h][0]=h,c[h][0]="D";for(h=0;h<=
n;h++)k[0][h]=h,c[0][h]="I";for(h=1;h<=f;h++)for(g=1;g<=n;g++)p=H(d[h-1],e[g-1])?0:1,k[h][g-1]<k[h-1][g]&&k[h][g-1]<k[h-1][g-1]+p?(k[h][g]=k[h][g-1]+1,c[h][g]="I"):k[h-1][g]<k[h-1][g-1]+p?(k[h][g]=k[h-1][g]+1,c[h][g]="D"):(k[h][g]=k[h-1][g-1]+p,c[h][g]=1==p?"R":"-");d=[];h=f;g=n;do f=c[h][g],d.push(f),"-"!=f&&r++,"R"==f||"-"==f?(h--,g--):"D"==f?h--:g--;while(0!=h||0!=g);c=d.reverse()}return c},getMovePrescription:function(a,c,b){b=b||this._getValue();var d=a||[],f=b||[];a=this.getPrescription(a||
[],b||[]);b=[];var e,g,k,h={},p,r;e=0;for(g=d.length;e<g;e++)(k=c(d[e]))&&(h[k]=e);p=0;var s={};e=0;for(g=a.length;e<g;e++)d=a[e],"D"!=d&&(k=c(f[p]),void 0!=k&&!0!==s[k]&&void 0!==(r=h[k])?(b.push(r),s[k]=!0):b.push(d),p++);return b},setValue:function(a){var b=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);"attr"==b?this.obj[this.code]=a:"expr"==b?(this.setterFn||(this.setterFn=Q(this.code)),this.setterFn(this.obj,a)):"object"==b&&(this.obj=a)},onInputParamChange:function(a,
b,c){this.setValue(this.lastSetValue);c&&this.checkAll()},onPipeParamChange:function(a,b,c){this.check()},onObserverChange:function(a){var b=this.code,c,d,f;c=0;for(d=a.length;c<d;c++)if(f=a[c],f.name==b){this.obsrvChanged=!0;break}},_check:function(a){var b=this._getValue(),d=this.currCopy;return(this.obsrvDelegate?this.obsrvChanged:!H(d,b))?(this.curr=b,this.prev=d,this.currCopy=z(b)?b:I(b),this.obsrvChanged=!1,c.trigger(this.id,b,d,a),!0):!1},check:function(a){return this._check(a)},checkAll:function(){return this.obj.$$watchers.$checkAll()},
getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var d=this.id;a&&c.un(d,a,b);return c.hasListener(d)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,d,f,e,g,n;this.itv&&this.clearInterval();if(a)for(d=-1,f=a.length;++d<f;)for(n=a[d][2],e=-1,g=n.length;++e<g;)n[e].unsubscribeAndDestroy(this.check,
this);if(b)for(d=-1,f=b.length;++d<f;)for(n=b[d][2],e=-1,g=n.length;++e<g;)n[e].unsubscribeAndDestroy(this.onInputParamChange,this);this.obsrvDelegate&&Object.unobserve(this.obj,this.obsrvDelegate);this.obj&&(this.obj.$$watchers.$codes[this.origCode]=null);c.destroyEvent(this.id);for(d in this)this.hasOwnProperty(d)&&(this[d]=null)}},!0,!1);var e=function(a,b,c,e,g,p){b=f(a,r(b));return a?(a.$$watchers||(a.$$watchers={$codes:{},$checkAll:function(){var a=this.$codes,b,c=0;for(b in a)a[b]&&a[b].check()&&
c++;return c},$destroyAll:function(){var a=this.$codes,b;for(b in a)a[b]&&(a[b].destroy(),a[b]=null)}}),a.$$watchers.$codes[b]?a.$$watchers.$codes[b].subscribe(c,e,{append:[g],allowDupes:!0}):a.$$watchers.$codes[b]=new d(a,b,c,e,g,p),a.$$watchers.$codes[b]):new d(a,b,c,e,g,p)},f=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},g=function(a,c){var d;return(d=b(a))?d:K(a)(c)};d.create=e;d.unsubscribeAndDestroy=function(a,
b,c,d){b=r(b);(a=a.$$watchers?a.$$watchers.$codes:null)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&(a[b]=null)};d.normalizeExpr=f;d.eval=g;d.usesNativeObserver=function(){return a};return d}();MetaphorJs.Watchable=y;"undefined"!=typeof global?global.MetaphorJs=MetaphorJs:window.MetaphorJs=MetaphorJs})();
