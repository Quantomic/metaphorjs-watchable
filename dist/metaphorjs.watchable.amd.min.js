'use strict';define("metaphorjs-watchable",["metaphorjs-observable"],function(I){function s(b){return"object"==typeof b&&5===q(b)}function u(b){return"function"==typeof b}function t(b){return"string"==typeof b||b===""+b}function w(b){return b===window||b&&b.document&&b.location&&b.alert&&b.setInterval}function v(b){return"object"==typeof b&&3===q(b)&&!b.nodeType&&b.constructor===Object}function B(b){return!0===b||!1===b}function x(b){b=q(b);return 3>b&&-1<b}function J(){return!1}function K(b,m,d,
f){setTimeout(function(){b.apply(m,d||[])},f||0)}function y(b){var m=b.stack||Error().stack;if("undefined"!=typeof console&&console.log)K(function(){console.log(b);m&&console.log(m)});else throw b;}function z(){}var C=function(){var b=["0","0","0"];return function(){for(var m=b.length,d;m;){m--;d=b[m].charCodeAt(0);if(57==d)return b[m]="A",b.join("");if(90==d)b[m]="0";else return b[m]=String.fromCharCode(d+1),b.join("")}b.unshift("0");return b.join("")}}(),L=Object.prototype.toString,q=function(){var b=
{"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(m){if(!m){if(null===m)return 6;if(void 0===m)return 7}var d=b[L.call(m)];return void 0===d?-1:1==d&&isNaN(m)?8:d}}(),r=function(){return String.prototype.trim?function(b){return t(b)?b.trim():b}:function(b){return t(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),D=Array.prototype.slice,E=function(){return function m(d,
f){if(d===f)return!0;if(null===d||null===f)return!1;if(d!==d&&f!==f)return!0;var h=typeof d,g;if(h==typeof f&&"object"==h)if(s(d)){if(!s(f))return!1;if((h=d.length)==f.length){for(g=0;g<h;g++)if(!m(d[g],f[g]))return!1;return!0}}else{if(10===q(d))return 10===q(f)&&d.getTime()==f.getTime();if(9===q(d)&&9===q(f))return d.toString()==f.toString();if(w(d)||w(f)||s(f))return!1;h={};for(g in d)if("$"!=g.charAt(0)&&!u(d[g])){if(!m(d[g],f[g]))return!1;h[g]=!0}for(g in f)if(!h.hasOwnProperty(g)&&"$"!=g.charAt(0)&&
void 0!==f[g]&&!u(f[g]))return!1;return!0}return!1}}(),F=function(){return function m(d,f){if(w(d))throw Error("Cannot copy window object");if(f){if(d===f)throw Error("Objects are identical");if(s(d))for(var h=f.length=0,g=d.length;h<g;h++)f.push(m(d[h]));else{for(h in f)delete f[h];for(h in d)d.hasOwnProperty(h)&&("$"==h.charAt(0)||u(d[h])?f[h]=d[h]:f[h]=m(d[h]))}}else(f=d)&&(s(d)?f=m(d,[]):10===q(d)?f=new Date(d.getTime()):9===q(d)?f=new RegExp(d.source):v(d)&&(f=m(d,{})));return f}}(),M=function(){return function m(){var d=
!1,f=!1,h=D.call(arguments),g=h.shift(),n,a,e;B(h[h.length-1])&&(d=h.pop());B(h[h.length-1])&&(f=d,d=h.pop());for(;h.length;)if(n=h.shift())for(a in n)if(n.hasOwnProperty(a)&&void 0!==(e=n[a]))if(f)if(g[a]&&v(g[a])&&v(e))m(g[a],e,d,f);else{if(!0===d||void 0==g[a])v(e)?(g[a]={},m(g[a],e,d,!0)):g[a]=e}else if(!0===d||void 0==g[a])g[a]=e;return g}}(),N=function(){var b=Object.prototype.toString,m=Function.prototype.toString,d=/^\[object .+?Constructor\]$/,f=RegExp("^"+String(b).replace(/[.*+?^${}()|[\]\/\\]/g,
"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return function(h){var g=typeof h;return"function"==g?!("prototype"in h)||f.test(m.call(h)):h&&"object"==g&&d.test(b.call(h))||!1}}(),G=function(){var b=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,m=Function,d=function(a,e){return function(c){var d=D.call(arguments),k;d.push(null);d.push(a);if(e){for(k=a.apply(null,d);(void 0===k||"number"==typeof k&&isNaN(k))&&!c.$isRoot;)c=c.$parent,d[0]=c,k=a.apply(null,d);return k}return a.apply(null,
d)}},f={},h=0,g={},n=0,a={},e=0,c=function(){1E3<=h&&(f={});1E3<=n&&(g={});1E3<=e&&(a={})};return{createGetter:function(a){try{return f[a]?f[a]:(h++,f[a]=d(new m("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(b,"$1____.$3"),";} catch (thrownError) { return undefined; }")),!0))}catch(e){return y(e),z}},createSetter:function(a){try{if(!g[a]){n++;var e=a.replace(b,"$1____.$3");return g[a]=d(new m("____","$$$$","$$interceptor","$$itself","".concat("try {",e," = $$$$",";} catch (thrownError) { return undefined; }")))}return g[a]}catch(c){return y(c),
z}},createFunc:function(c){try{return a[c]?a[c]:(e++,a[c]=d(new m("____","$$interceptor","$$itself","".concat("try {",c.replace(b,"$1____.$3"),";} catch (thrownError) { return undefined; }"))))}catch(f){return y(f),z}},resetCache:c,enableResetCacheInterval:function(){setTimeout(c,1E4)}}}(),H=G.createGetter,O=G.createSetter;return function(){var b=Object.observe&&N(Object.observe),m=function(a){if(!t(a))return!0;var e=a.substr(0,1),c=a.length-1;return'"'!=e&&"'"!=e||a.indexOf(e,1)!=c?!1:a.substring(1,
c)},d,f=function(a,e,c,b,f,A){d||(d=new I);var p=C(),k;A&&(this.namespace=A,this.nsGet=A.get);this.origCode=e;t(e)||(b=c,c=e,e=null,k="object");t(a)&&(b=c,c=e,e=a,a=null);e&&a&&(k=a.hasOwnProperty(e)?"attr":"expr");e&&!a&&(k="expr");if(c)d.on(p,c,b||this,{append:[f],allowDupes:!0});if("expr"==k){e=this._processInputPipes(e,a);e=this._processPipes(e,a);if(this.inputPipes||this.pipes)e=g(a,e),k=a.hasOwnProperty(e)?"attr":"expr";if(this.staticValue=m(e))k="static"}this.userData=f;this.code=e;this.id=
p;this.type=k;this.obj=a;"expr"==k&&(this.getterFn=H(e));"static"!=k||this.pipes?(this.curr=this.curr||this._getValue(),this.currCopy=x(this.curr)?this.curr:F(this.curr)):(this.check=J,this.curr=this.prev=this.staticValue)};M(f.prototype,{namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,obsrvDelegate:null,obsrvChanged:!1,
_indexArrayItems:function(a){var e="$$"+this.id,c,d,b;if(a)for(c=0,d=a.length;c<d;c++)b=a[c],!b||x(b)||b[e]||(b[e]=C())},_processInputPipes:function(a,e){if(-1==a.indexOf(">>"))return a;for(var c=0,d=a.length,b=[],f,p,k,l=a;c<d&&-1!=(f=a.indexOf(">>",c));)p=a.charAt(f-1),k=a.charAt(f+2),"\\"!=p&&"'"!=p&&'"'!=p&&"'"!=k&&'"'!=k&&(c=r(a.substring(c,f)).split(":"),l=a.substr(f+2),this._addPipe(b,c,e,this.onInputParamChange)),c=f+2;b.length&&(this.inputPipes=b);return r(l)},_addPipe:function(a,e,c,d){var b=
e.shift(),f=null,p=[],k;this.nsGet&&(f=this.nsGet("filter."+b,!0));f||(f=window[b]||c[b]);if(u(f)){b=-1;for(k=e.length;++b<k;p.push(h(c,e[b],d,this,null,this.namespace)));a.push([f,e,p])}},_processPipes:function(a,e){if(-1==a.indexOf("|"))return a;for(var c=0,d=a.length,b=[],f,p,k,l=!1,h=a;c<d;)if(-1!=(f=a.indexOf("|",c)))p=a.charAt(f-1),k=a.charAt(f+1),"|"!=p&&"'"!=p&&'"'!=p&&"|"!=k&&"'"!=k&&'"'!=k&&(l?(c=r(a.substring(c,f)).split(":"),this._addPipe(b,c,e)):(l=!0,h=r(a.substring(0,f)))),c=f+1;else{l&&
(c=r(a.substr(c)).split(":"),this._addPipe(b,c,e,this.onPipeParamChange));break}b.length&&(this.pipes=b);return h},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":a=this.obj}s(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,e){if(e){var c,b,d,f=e.length,h=this.obj,
k,l;for(c=0;c<f;c++){d=e[c][1];b=[];k=-1;for(l=d.length;++k<l;b.push(n(d[k],h)));b.unshift(h);b.unshift(a);a=e[c][0].apply(null,b)}}return a},subscribe:function(a,e,c){d.on(this.id,a,e,c)},unsubscribe:function(a,e){return d.un(this.id,a,e)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,
e){var c;e=e||this._getValue();var b=a||[],d=e||[],f=b.length,h=d.length,k=Array(f+1);c=Array(f+1);var l,g,m,n=0;if(f==h&&0==f)c=[];else{for(l=0;l<=f;l++)k[l]=Array(h+1),c[l]=Array(h+1),k[l][0]=l,c[l][0]="D";for(l=0;l<=h;l++)k[0][l]=l,c[0][l]="I";for(l=1;l<=f;l++)for(g=1;g<=h;g++)m=E(b[l-1],d[g-1])?0:1,k[l][g-1]<k[l-1][g]&&k[l][g-1]<k[l-1][g-1]+m?(k[l][g]=k[l][g-1]+1,c[l][g]="I"):k[l-1][g]<k[l-1][g-1]+m?(k[l][g]=k[l-1][g]+1,c[l][g]="D"):(k[l][g]=k[l-1][g-1]+m,c[l][g]=1==m?"R":"-");b=[];l=f;g=h;do f=
c[l][g],b.push(f),"-"!=f&&n++,"R"==f||"-"==f?(l--,g--):"D"==f?l--:g--;while(0!=l||0!=g);c=b.reverse()}return c},getMovePrescription:function(a,e,c){c=c||this._getValue();var b=a||[],f=c||[];a=this.getPrescription(a||[],c||[]);c=[];var d,g,k,h={},m,n;d=0;for(g=b.length;d<g;d++)(k=e(b[d]))&&(h[k]=d);m=0;var q={};d=0;for(g=a.length;d<g;d++)b=a[d],"D"!=b&&(k=e(f[m]),void 0!=k&&!0!==q[k]&&void 0!==(n=h[k])?(c.push(n),q[k]=!0):c.push(b),m++);return c},setValue:function(a){var e=this.type;this.lastSetValue=
a;a=this._runThroughPipes(a,this.inputPipes);"attr"==e?this.obj[this.code]=a:"expr"==e?(this.setterFn||(this.setterFn=O(this.code)),this.setterFn(this.obj,a)):"object"==e&&(this.obj=a)},onInputParamChange:function(a,e,c){this.setValue(this.lastSetValue);c&&this.checkAll()},onPipeParamChange:function(a,e,c){this.check()},onObserverChange:function(a){var e=this.code,c,b,d;c=0;for(b=a.length;c<b;c++)if(d=a[c],d.name==e){this.obsrvChanged=!0;break}},_check:function(a){var e=this._getValue(),c=this.currCopy;
return(this.obsrvDelegate?this.obsrvChanged:!E(c,e))?(this.curr=e,this.prev=c,this.currCopy=x(e)?e:F(e),this.obsrvChanged=!1,d.trigger(this.id,e,c,a),!0):!1},check:function(a){return this._check(a)},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var e=this;e.itv&&e.clearInterval();e.itv=setInterval(function(){e.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,
e){var c=this.id;a&&d.un(c,a,e);return d.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,e=this.inputPipes,c,b,f,g,h;this.itv&&this.clearInterval();if(a)for(c=-1,b=a.length;++c<b;)for(h=a[c][2],f=-1,g=h.length;++f<g;)h[f].unsubscribeAndDestroy(this.check,this);if(e)for(c=-1,b=e.length;++c<b;)for(h=e[c][2],f=-1,g=h.length;++f<g;)h[f].unsubscribeAndDestroy(this.onInputParamChange,this);this.obsrvDelegate&&Object.unobserve(this.obj,this.obsrvDelegate);this.obj&&(this.obj.$$watchers.$codes[this.origCode]=
null);d.destroyEvent(this.id);for(c in this)this.hasOwnProperty(c)&&(this[c]=null)}},!0,!1);var h=function(a,e,c,b,d,h){e=g(a,r(e));return a?(a.$$watchers||(a.$$watchers={$codes:{},$checkAll:function(){var a=this.$codes,b,e=0;for(b in a)a[b]&&a[b].check()&&e++;return e},$destroyAll:function(){var a=this.$codes,b;for(b in a)a[b]&&(a[b].destroy(),a[b]=null)}}),a.$$watchers.$codes[e]?a.$$watchers.$codes[e].subscribe(c,b,{append:[d],allowDupes:!0}):a.$$watchers.$codes[e]=new f(a,e,c,b,d,h),a.$$watchers.$codes[e]):
new f(a,e,c,b,d,h)},g=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},n=function(a,b){var c;return(c=m(a))?c:H(a)(b)};f.create=h;f.unsubscribeAndDestroy=function(a,b,c,d){b=r(b);(a=a.$$watchers?a.$$watchers.$codes:null)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&(a[b]=null)};f.normalizeExpr=g;f.eval=n;f.usesNativeObserver=function(){return b};return f}()});
