'use strict';define("metaphorjs-watchable",["metaphorjs-observable"],function(H){function s(b){return"object"==typeof b&&5===q(b)}function u(b){return"function"==typeof b}function t(b){return"string"==typeof b||b===""+b}function z(b){return b===window||b&&b.document&&b.location&&b.alert&&b.setInterval}function v(b){return"object"==typeof b&&3===q(b)&&!b.nodeType&&b.constructor===Object}function A(b){return!0===b||!1===b}function w(b){b=q(b);return 3>b&&-1<b}function I(){return!1}function J(b,m,h,
g){setTimeout(function(){b.apply(m,h||[])},g||0)}function x(b){var m=b.stack||Error().stack;if("undefined"!=typeof console&&console.log)J(function(){console.log(b);m&&console.log(m)});else throw b;}function y(){}var B=function(){var b=["0","0","0"];return function(){for(var m=b.length,h;m;){m--;h=b[m].charCodeAt(0);if(57==h)return b[m]="A",b.join("");if(90==h)b[m]="0";else return b[m]=String.fromCharCode(h+1),b.join("")}b.unshift("0");return b.join("")}}(),K=Object.prototype.toString,q=function(){var b=
{"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(m){if(!m){if(null===m)return 6;if(void 0===m)return 7}var h=b[K.call(m)];return void 0===h?-1:1==h&&isNaN(m)?8:h}}(),r=function(){return String.prototype.trim?function(b){return t(b)?b.trim():b}:function(b){return t(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),C=Array.prototype.slice,D=function(){return function m(h,
g){if(h===g)return!0;if(null===h||null===g)return!1;if(h!==h&&g!==g)return!0;var d=typeof h,f;if(d==typeof g&&"object"==d)if(s(h)){if(!s(g))return!1;if((d=h.length)==g.length){for(f=0;f<d;f++)if(!m(h[f],g[f]))return!1;return!0}}else{if(10===q(h))return 10===q(g)&&h.getTime()==g.getTime();if(9===q(h)&&9===q(g))return h.toString()==g.toString();if(z(h)||z(g)||s(g))return!1;d={};for(f in h)if("$"!=f.charAt(0)&&!u(h[f])){if(!m(h[f],g[f]))return!1;d[f]=!0}for(f in g)if(!d.hasOwnProperty(f)&&"$"!=f.charAt(0)&&
void 0!==g[f]&&!u(g[f]))return!1;return!0}return!1}}(),E=function(){var b="undefined"!=typeof window?window:null,m="undefined"!=typeof global?global:null;return function g(d,f){if(b&&d===b)throw Error("Cannot copy window object");if(m&&d===m)throw Error("Cannot copy global object");if(f){if(d===f)throw Error("Objects are identical");if(s(d))for(var n=f.length=0,a=d.length;n<a;n++)f.push(g(d[n]));else{for(n in f)delete f[n];for(n in d)d.hasOwnProperty(n)&&("$"==n.charAt(0)||u(d[n])?f[n]=d[n]:f[n]=
g(d[n]))}}else(f=d)&&(s(d)?f=g(d,[]):10===q(d)?f=new Date(d.getTime()):9===q(d)?f=new RegExp(d.source):v(d)&&(f=g(d,{})));return f}}(),L=function(){return function m(){var h=!1,g=!1,d=C.call(arguments),f=d.shift(),n,a,c;A(d[d.length-1])&&(h=d.pop());A(d[d.length-1])&&(g=h,h=d.pop());for(;d.length;)if(n=d.shift())for(a in n)if(n.hasOwnProperty(a)&&void 0!==(c=n[a]))if(g)if(f[a]&&v(f[a])&&v(c))m(f[a],c,h,g);else{if(!0===h||void 0==f[a])v(c)?(f[a]={},m(f[a],c,h,!0)):f[a]=c}else if(!0===h||void 0==f[a])f[a]=
c;return f}}(),M=function(){var b=Object.prototype.toString,m=Function.prototype.toString,h=/^\[object .+?Constructor\]$/,g=RegExp("^"+String(b).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return function(d){var f=typeof d;return"function"==f?!("prototype"in d)||g.test(m.call(d)):d&&"object"==f&&h.test(b.call(d))||!1}}(),F=function(){var b=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,m=Function,h=function(a,c){return function(e){var b=C.call(arguments),
l;b.push(null);b.push(a);if(c){for(l=a.apply(null,b);(void 0===l||"number"==typeof l&&isNaN(l))&&!e.$isRoot;)e=e.$parent,b[0]=e,l=a.apply(null,b);return l}return a.apply(null,b)}},g={},d=0,f={},n=0,a={},c=0,e=function(){1E3<=d&&(g={});1E3<=n&&(f={});1E3<=c&&(a={})};return{createGetter:function(a){try{return g[a]?g[a]:(d++,g[a]=h(new m("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(b,"$1____.$3"),";} catch (thrownError) { return undefined; }")),!0))}catch(c){return x(c),y}},
createSetter:function(a){try{if(!f[a]){n++;var c=a.replace(b,"$1____.$3");return f[a]=h(new m("____","$$$$","$$interceptor","$$itself","".concat("try {",c," = $$$$",";} catch (thrownError) { return undefined; }")))}return f[a]}catch(e){return x(e),y}},createFunc:function(e){try{return a[e]?a[e]:(c++,a[e]=h(new m("____","$$interceptor","$$itself","".concat("try {",e.replace(b,"$1____.$3"),";} catch (thrownError) { return undefined; }"))))}catch(f){return x(f),y}},resetCache:e,enableResetCacheInterval:function(){setTimeout(e,
1E4)}}}(),G=F.createGetter,N=F.createSetter;return function(){var b=Object.observe&&M(Object.observe),m=function(a){if(!t(a))return!0;var c=a.substr(0,1),e=a.length-1;return'"'!=c&&"'"!=c||a.indexOf(c,1)!=e?!1:a.substring(1,e)},h,g=function(a,c,e,b,d,p){h||(h=new H);var g=B(),l;p&&(this.namespace=p,this.nsGet=p.get);this.origCode=c;t(c)||(b=e,e=c,c=null,l="object");t(a)&&(b=e,e=c,c=a,a=null);c&&a&&(l=a.hasOwnProperty(c)?"attr":"expr");c&&!a&&(l="expr");if(e)h.on(g,e,b||this,{append:[d],allowDupes:!0});
if("expr"==l){c=this._processInputPipes(c,a);c=this._processPipes(c,a);if(this.inputPipes||this.pipes)c=f(a,c),l=a.hasOwnProperty(c)?"attr":"expr";if(this.staticValue=m(c))l="static"}this.userData=d;this.code=c;this.id=g;this.type=l;this.obj=a;"expr"==l&&(this.getterFn=G(c));"static"!=l||this.pipes?(this.curr=this.curr||this._getValue(),this.currCopy=w(this.curr)?this.curr:E(this.curr)):(this.check=I,this.curr=this.prev=this.staticValue)};L(g.prototype,{namespace:null,nsGet:null,staticValue:null,
origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,obsrvDelegate:null,obsrvChanged:!1,_indexArrayItems:function(a){var c="$$"+this.id,e,b,f;if(a)for(e=0,b=a.length;e<b;e++)f=a[e],!f||w(f)||f[c]||(f[c]=B())},_processInputPipes:function(a,c){if(-1==a.indexOf(">>"))return a;for(var e=0,b=a.length,f=[],p,d,l,k=a;e<b&&-1!=(p=a.indexOf(">>",e));)d=a.charAt(p-
1),l=a.charAt(p+2),"\\"!=d&&"'"!=d&&'"'!=d&&"'"!=l&&'"'!=l&&(e=r(a.substring(e,p)).split(":"),k=a.substr(p+2),this._addPipe(f,e,c,this.onInputParamChange)),e=p+2;f.length&&(this.inputPipes=f);return r(k)},_addPipe:function(a,c,e,b){var f=c.shift(),p=null,h=[],l;this.nsGet&&(p=this.nsGet("filter."+f,!0));p||(p=window[f]||e[f]);if(u(p)){f=-1;for(l=c.length;++f<l;h.push(d(e,c[f],b,this,null,this.namespace)));a.push([p,c,h])}},_processPipes:function(a,c){if(-1==a.indexOf("|"))return a;for(var e=0,b=a.length,
f=[],d,h,l,k=!1,g=a;e<b;)if(-1!=(d=a.indexOf("|",e)))h=a.charAt(d-1),l=a.charAt(d+1),"|"!=h&&"'"!=h&&'"'!=h&&"|"!=l&&"'"!=l&&'"'!=l&&(k?(e=r(a.substring(e,d)).split(":"),this._addPipe(f,e,c)):(k=!0,g=r(a.substring(0,d)))),e=d+1;else{k&&(e=r(a.substr(e)).split(":"),this._addPipe(f,e,c,this.onPipeParamChange));break}f.length&&(this.pipes=f);return g},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);
break;case "object":a=this.obj}s(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,c){if(c){var e,b,f,d=c.length,h=this.obj,l,k;for(e=0;e<d;e++){f=c[e][1];b=[];l=-1;for(k=f.length;++l<k;b.push(n(f[l],h)));b.unshift(h);b.unshift(a);a=c[e][0].apply(null,b)}}return a},subscribe:function(a,c,e){h.on(this.id,a,c,e)},unsubscribe:function(a,c){return h.un(this.id,a,c)},hasPipes:function(){return null!==
this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,c){var e;c=c||this._getValue();var b=a||[],f=c||[],d=b.length,h=f.length,l=Array(d+1);e=Array(d+1);var k,g,m,n=0;if(d==h&&0==d)e=[];else{for(k=0;k<=d;k++)l[k]=Array(h+1),e[k]=Array(h+1),l[k][0]=k,e[k][0]="D";for(k=0;k<=h;k++)l[0][k]=k,e[0][k]="I";for(k=1;k<=
d;k++)for(g=1;g<=h;g++)m=D(b[k-1],f[g-1])?0:1,l[k][g-1]<l[k-1][g]&&l[k][g-1]<l[k-1][g-1]+m?(l[k][g]=l[k][g-1]+1,e[k][g]="I"):l[k-1][g]<l[k-1][g-1]+m?(l[k][g]=l[k-1][g]+1,e[k][g]="D"):(l[k][g]=l[k-1][g-1]+m,e[k][g]=1==m?"R":"-");b=[];k=d;g=h;do d=e[k][g],b.push(d),"-"!=d&&n++,"R"==d||"-"==d?(k--,g--):"D"==d?k--:g--;while(0!=k||0!=g);e=b.reverse()}return e},getMovePrescription:function(a,c,e){e=e||this._getValue();var b=a||[],f=e||[];a=this.getPrescription(a||[],e||[]);e=[];var d,g,h,k={},m,n;d=0;for(g=
b.length;d<g;d++)(h=c(b[d]))&&(k[h]=d);m=0;var q={};d=0;for(g=a.length;d<g;d++)b=a[d],"D"!=b&&(h=c(f[m]),void 0!=h&&!0!==q[h]&&void 0!==(n=k[h])?(e.push(n),q[h]=!0):e.push(b),m++);return e},setValue:function(a){var c=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);"attr"==c?this.obj[this.code]=a:"expr"==c?(this.setterFn||(this.setterFn=N(this.code)),this.setterFn(this.obj,a)):"object"==c&&(this.obj=a)},onInputParamChange:function(a,c,e){this.setValue(this.lastSetValue);e&&
this.checkAll()},onPipeParamChange:function(a,c,e){this.check()},onObserverChange:function(a){var c=this.code,e,b,d;e=0;for(b=a.length;e<b;e++)if(d=a[e],d.name==c){this.obsrvChanged=!0;break}},_check:function(a){var c=this._getValue(),e=this.currCopy;return(this.obsrvDelegate?this.obsrvChanged:!D(e,c))?(this.curr=c,this.prev=e,this.currCopy=w(c)?c:E(c),this.obsrvChanged=!1,h.trigger(this.id,c,e,a),!0):!1},check:function(a){return this._check(a)},checkAll:function(){return this.obj.$$watchers.$checkAll()},
getLastResult:function(){return this.curr},setInterval:function(a){var c=this;c.itv&&c.clearInterval();c.itv=setInterval(function(){c.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,c){var e=this.id;a&&h.un(e,a,c);return h.hasListener(e)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,c=this.inputPipes,e,b,d,f,g;this.itv&&this.clearInterval();if(a)for(e=-1,b=a.length;++e<b;)for(g=a[e][2],d=-1,f=g.length;++d<f;)g[d].unsubscribeAndDestroy(this.check,
this);if(c)for(e=-1,b=c.length;++e<b;)for(g=c[e][2],d=-1,f=g.length;++d<f;)g[d].unsubscribeAndDestroy(this.onInputParamChange,this);this.obsrvDelegate&&Object.unobserve(this.obj,this.obsrvDelegate);this.obj&&(this.obj.$$watchers.$codes[this.origCode]=null);h.destroyEvent(this.id);for(e in this)this.hasOwnProperty(e)&&(this[e]=null)}},!0,!1);var d=function(a,c,e,b,d,h){c=f(a,r(c));return a?(a.$$watchers||(a.$$watchers={$codes:{},$checkAll:function(){var a=this.$codes,c,b=0;for(c in a)a[c]&&a[c].check()&&
b++;return b},$destroyAll:function(){var a=this.$codes,c;for(c in a)a[c]&&(a[c].destroy(),a[c]=null)}}),a.$$watchers.$codes[c]?a.$$watchers.$codes[c].subscribe(e,b,{append:[d],allowDupes:!0}):a.$$watchers.$codes[c]=new g(a,c,e,b,d,h),a.$$watchers.$codes[c]):new g(a,c,e,b,d,h)},f=function(a,c){if(a&&c){if(a.hasOwnProperty(c))return c;var b;if("."==c.charAt(0)&&(b=c.substr(1),a.hasOwnProperty(b)))return b}return c},n=function(a,c){var b;return(b=m(a))?b:G(a)(c)};g.create=d;g.unsubscribeAndDestroy=function(a,
c,b,d){c=r(c);(a=a.$$watchers?a.$$watchers.$codes:null)&&a[c]&&a[c].unsubscribeAndDestroy(b,d)&&(a[c]=null)};g.normalizeExpr=f;g.eval=n;g.usesNativeObserver=function(){return b};return g}()});
