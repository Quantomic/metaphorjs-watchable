define("metaphorjs-watchable",["metaphorjs-observable"],function(Q){var R=function(){var d=["0","0","0"];return function(){for(var h=d.length,p;h;){h--;p=d[h].charCodeAt(0);if(57==p)return d[h]="A",d.join("");if(90==p)d[h]="0";else return d[h]=String.fromCharCode(p+1),d.join("")}d.unshift("0");return d.join("")}}(),t=Object.prototype.toString,r=function(d){var h;if(h=d&&null!=d&&"object"===typeof d)h=d.length,h="number"==typeof h&&!isNaN(h);return!(!h||"[object Array]"!=t.call(d))},A=function(d){return"[object Date]"===
t.call(d)},B=function(d){return"function"===typeof d},C=function(d){return"[object RegExp]"===t.call(d)},D=function(d){return d&&d.document&&d.location&&d.alert&&d.setInterval},u=function(d){return"string"==typeof d},s=function(){return String.prototype.trim?function(d){return u(d)?d.trim():d}:function(d){return u(d)?d.replace(/^\s\s*/,"").replace(/\s\s*$/,""):d}}(),v=function(){},I=Array.prototype.slice;return function(){var d=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,h=function(a){if(!u(a))return!0;var b=
a.substr(0,1),c=a.length-1;return'"'!=b&&"'"!=b||a.indexOf(b,1)!=c?!1:a.substring(1,c)},p=function(a,b){if(D(a))throw Error("Cannot copy window object");if(b){if(a===b)throw Error("Objects are identical");if(r(a))for(var c=b.length=0;c<a.length;c++)b.push(p(a[c]));else{for(c in b)delete b[c];for(c in a)b[c]=p(a[c])}}else(b=a)&&(r(a)?b=p(a,[]):A(a)?b=new Date(a.getTime()):C(a)?b=new RegExp(a.source):null!=a&&"object"===typeof a&&(b=p(a,{})));return b},w=function(a,b){if(a===b)return!0;if(null===a||
null===b)return!1;if(a!==a&&b!==b)return!0;var c=typeof a,k;if(c==typeof b&&"object"==c)if(r(a)){if(!r(b))return!1;if((c=a.length)==b.length){for(k=0;k<c;k++)if(!w(a[k],b[k]))return!1;return!0}}else{if(A(a))return A(b)&&a.getTime()==b.getTime();if(C(a)&&C(b))return a.toString()==b.toString();if(D(a)||D(b)||r(b))return!1;c={};for(k in a)if(("$"!==k.charAt(0)||"object"!=typeof a[k])&&!B(a[k])){if(!w(a[k],b[k]))return!1;c[k]=!0}for(k in b)if(!c.hasOwnProperty(k)&&"$"!==k.charAt(0)&&void 0!==b[k]&&!B(b[k]))return!1;
return!0}return!1},t=function(a,b){var c=a.length,k=b.length,f=Array(c+1),d=Array(c+1),e,g,q,h,m=0;if(c==k&&0==c)return{changes:0,distance:0,prescription:[]};for(e=0;e<=c;e++)f[e]=Array(k+1),d[e]=Array(k+1),f[e][0]=e,d[e][0]="D";for(e=0;e<=k;e++)f[0][e]=e,d[0][e]="I";for(e=1;e<=c;e++)for(g=1;g<=k;g++)q=w(a[e-1],b[g-1])?0:1,f[e][g-1]<f[e-1][g]&&f[e][g-1]<f[e-1][g-1]+q?(f[e][g]=f[e][g-1]+1,d[e][g]="I"):f[e-1][g]<f[e-1][g-1]+q?(f[e][g]=f[e-1][g]+1,d[e][g]="D"):(f[e][g]=f[e-1][g-1]+q,d[e][g]=1==q?"R":
"-");h=[];e=c;g=k;do q=d[e][g],h.push(q),"-"!=q&&m++,"R"==q||"-"==q?(e--,g--):"D"==q?e--:g--;while(0!=e||0!=g);return{changes:m/h.length,distance:f[c][k],prescription:h.reverse()}},n,m=function(a,b,c,k,f,d){n||(n=new Q);var e=R(),g;d&&(this.namespace=d,this.nsGet=d.get);this.origCode=b;r(a)&&null===b?g="array":(u(b)||(k=c,c=b,b=null,g="object"),u(a)&&(k=c,c=b,b=a,a=null),b&&a&&(g=a.hasOwnProperty(b)?"attr":"expr"),b&&!a&&(g="expr"));if(c)n.on(e,c,k||this,{append:[f],allowDupes:!0});if("expr"==g){b=
this._processInputPipes(b,a);b=this._processPipes(b,a);if(this.inputPipes||this.pipes)b=E(a,b),g=a.hasOwnProperty(b)?"attr":"expr";if(this.staticValue=h(b))g="static"}this.userData=f;this.code=b;this.id=e;this.type=g;this.obj=a;"expr"==g&&(this.getterFn=F(b));this.curr=this._getValue()};m.prototype={namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,
_processInputPipes:function(a,b){if(-1==a.indexOf(">>"))return a;for(var c=0,d=a.length,f=[],l,e,g,h=a;c<d&&-1!=(l=a.indexOf(">>",c));)e=a.charAt(l-1),g=a.charAt(l+2),"\\"!=e&&"'"!=e&&'"'!=e&&"'"!=g&&'"'!=g&&(c=s(a.substring(c,l)).split(":"),h=a.substr(l+2),this._addPipe(f,c,b,this.onInputParamChange)),c=l+2;f.length&&(this.inputPipes=f);return s(h)},_addPipe:function(a,b,c,d){var f=b.shift(),l=null,e=[],g;this.nsGet&&(l=this.nsGet("filter."+f,!0));l||(l=window[f]||c[f]);if(B(l)){f=-1;for(g=b.length;++f<
g;e.push(J(c,b[f],d,this,null,this.namespace)));a.push([l,b,e])}},_processPipes:function(a,b){if(-1==a.indexOf("|"))return a;for(var c=0,d=a.length,f=[],l,e,g,h=!1,m=a;c<d;)if(-1!=(l=a.indexOf("|",c)))e=a.charAt(l-1),g=a.charAt(l+1),"|"!=e&&"'"!=e&&'"'!=e&&"|"!=g&&"'"!=g&&'"'!=g&&(h?(c=s(a.substring(c,l)).split(":"),this._addPipe(f,c,b)):(h=!0,m=s(a.substring(0,l)))),c=l+1;else{h&&(c=s(a.substr(c)).split(":"),this._addPipe(f,c,b,this.onPipeParamChange));break}f.length&&(this.pipes=f);return m},_checkCode:function(){var a=
this._getValue(),b=!1,c=this.curr;if(r(c)&&r(a))return b=t(c,a),b.changes?(this.curr=a.slice(),n.trigger(this.id,b,a,c),!0):!1;w(c,a)||(this.curr=a,n.trigger(this.id,a,c),b=!0);return b},_checkObject:function(){var a=this.obj,b=this.curr;return w(b,a)?!1:(this.curr=p(a),n.trigger(this.id,a,b),!0)},_checkArray:function(){var a=this.curr,b=this.obj,c=t(a,b);return c.changes?(this.curr=b.slice(),n.trigger(this.id,c,b,a),!0):!1},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;
break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);"undefined"==typeof a&&(a="");break;case "object":a=p(this.obj);break;case "array":a=this.obj}r(a)&&(a=a.slice());return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,b){if(b){var c,d,f,l=b.length,e=this.obj,g,h;for(c=0;c<l;c++){f=b[c][1];d=[];g=-1;for(h=f.length;++g<h;d.push(K(f[g],e)));d.unshift(e);d.unshift(a);a=b[c][0].apply(null,d)}}return a},subscribe:function(a,b,c){n.on(this.id,a,b,c)},
unsubscribe:function(a,b){return n.un(this.id,a,b)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},setValue:function(a){var b=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);if("attr"==b)this.obj[this.code]=a;else if("expr"==b)this.setterFn||(this.setterFn=L(this.code)),this.setterFn(this.obj,a);else if("array"==b)this.obj=a;else throw"Cannot set value";},onInputParamChange:function(){this.setValue(this.lastSetValue)},
onPipeParamChange:function(){this.check()},check:function(){switch(this.type){case "expr":case "attr":case "static":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=
null)},unsubscribeAndDestroy:function(a,b){var c=this.id;n.un(c,a,b);return n.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,c,d,f,h,e;this.itv&&this.clearInterval();if(a)for(c=-1,d=a.length;++c<d;)for(e=a[c][2],f=-1,h=e.length;++f<h;)e[f].unsubscribeAndDestroy(this.check,this);if(b)for(c=-1,d=b.length;++c<d;)for(e=b[c][2],f=-1,h=e.length;++f<h;)e[f].unsubscribeAndDestroy(this.onInputParamChange,this);this.obj&&delete this.obj.$$watchers[this.origCode];
delete this.id;delete this.curr;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;delete this.namespace;delete this.nsGet;n.destroyEvent(this.id)}};var J=function(a,b,c,d,f,h){b=E(a,s(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&this[a]instanceof
m&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof m)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].subscribe(c,d,{append:[f],allowDupes:!0}):a.$$watchers[b]=new m(a,b,c,d,f,h),a.$$watchers[b]):new m(a,b,c,d,f,h)},E=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},G=Function,M=function(a,b,c,d){for(;c&&!c.$isRoot;)if(c=c.$parent)try{return 4==
arguments.length?b.call(null,c,d,v,b):b.call(null,c,v,b)}catch(f){}},H=function(a){return function(){var b=I.call(arguments);b.push(M);b.push(a);var c=b=a.apply(null,b);return"undefined"==typeof c||!c&&"number"==typeof c&&isNaN(c)?(b=I.call(arguments),b.unshift(a),b.unshift(null),M.apply(null,b)):b}},x={},N=0,F=function(a){try{return x[a]?x[a]:(N++,x[a]=H(new G("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(d,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(b){return v}},
y={},O=0,L=function(a){try{if(!y[a]){O++;var b=a.replace(d,"$1____.$3");return y[a]=H(new G("____","$$$$","$$interceptor","$$itself","".concat("try {",b," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return y[a]}catch(c){return v}},z={},P=0,K=function(a,b){var c;return(c=h(a))?c:F(a)(b)},S=function(){1E3<=N&&(x={});1E3<=O&&(y={});1E3<=P&&(z={})};m.create=J;m.unsubscribeAndDestroy=function(a,b,c,d){b=s(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,
d)&&delete a[b]};m.normalizeExpr=E;m.prepareCode=function(a){return a.replace(d,"$1____.$3")};m.createGetter=F;m.createSetter=L;m.createFunc=function(a){try{return z[a]?z[a]:(P++,z[a]=H(new G("____","$$interceptor","$$itself","".concat("try {",a.replace(d,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(b){return v}};m.eval=K;m.enableResetCacheInterval=function(){setTimeout(S,1E4)};return m}()});
