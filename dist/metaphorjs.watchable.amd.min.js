'use strict';define("metaphorjs-watchable",["metaphorjs-observable"],function(I){function s(e){return"object"==typeof e&&5===q(e)}function u(e){return"function"==typeof e}function t(e){return"string"==typeof e||e===""+e}function w(){}function x(e){return e===window||e&&e.document&&e.location&&e.alert&&e.setInterval}function v(e){return"object"==typeof e&&3===q(e)&&!e.nodeType&&e.constructor===Object}function J(e,l,b,d){setTimeout(function(){e.apply(l,b||[])},d||0)}function y(e){var l=e.stack||Error().stack;
if("undefined"!=typeof console&&console.log)J(function(){console.log(e);l&&console.log(l)});else throw e;}function B(e){return!0===e||!1===e}function z(e){e=q(e);return 3>e&&-1<e}function K(){return!1}var C=function(){var e=["0","0","0"];return function(){for(var l=e.length,b;l;){l--;b=e[l].charCodeAt(0);if(57==b)return e[l]="A",e.join("");if(90==b)e[l]="0";else return e[l]=String.fromCharCode(b+1),e.join("")}e.unshift("0");return e.join("")}}(),L=Object.prototype.toString,q=function(){var e={"[object String]":0,
"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(l){if(!l){if(null===l)return 6;if(void 0===l)return 7}var b=e[L.call(l)];return void 0===b?-1:1==b&&isNaN(l)?8:b}}(),r=function(){return String.prototype.trim?function(e){return t(e)?e.trim():e}:function(e){return t(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}(),D=Array.prototype.slice,E=function(){return function l(b,d){if(b===d)return!0;
if(null===b||null===d)return!1;if(b!==b&&d!==d)return!0;var h=typeof b,g;if(h==typeof d&&"object"==h)if(s(b)){if(!s(d))return!1;if((h=b.length)==d.length){for(g=0;g<h;g++)if(!l(b[g],d[g]))return!1;return!0}}else{if(10===q(b))return 10===q(d)&&b.getTime()==d.getTime();if(9===q(b)&&9===q(d))return b.toString()==d.toString();if(x(b)||x(d)||s(d))return!1;h={};for(g in b)if("$"!=g.charAt(0)&&!u(b[g])){if(!l(b[g],d[g]))return!1;h[g]=!0}for(g in d)if(!h.hasOwnProperty(g)&&"$"!=g.charAt(0)&&void 0!==d[g]&&
!u(d[g]))return!1;return!0}return!1}}(),F=function(){return function l(b,d){if(x(b))throw Error("Cannot copy window object");if(d){if(b===d)throw Error("Objects are identical");if(s(b))for(var h=d.length=0,g=b.length;h<g;h++)d.push(l(b[h]));else{for(h in d)delete d[h];for(h in b)b.hasOwnProperty(h)&&("$"==h.charAt(0)||u(b[h])?d[h]=b[h]:d[h]=l(b[h]))}}else(d=b)&&(s(b)?d=l(b,[]):10===q(b)?d=new Date(b.getTime()):9===q(b)?d=new RegExp(b.source):v(b)&&(d=l(b,{})));return d}}(),M=function(){return function l(){var b=
!1,d=!1,h=D.call(arguments),g=h.shift(),n,a,c;B(h[h.length-1])&&(b=h.pop());B(h[h.length-1])&&(d=b,b=h.pop());for(;h.length;)if(n=h.shift())for(a in n)if(n.hasOwnProperty(a)&&void 0!==(c=n[a]))if(d)if(g[a]&&v(g[a])&&v(c))l(g[a],c,b,d);else{if(!0===b||void 0==g[a])v(c)?(g[a]={},l(g[a],c,b,!0)):g[a]=c}else if(!0===b||void 0==g[a])g[a]=c;return g}}(),N=function(){var e=Object.prototype.toString,l=Function.prototype.toString,b=/^\[object .+?Constructor\]$/,d=RegExp("^"+String(e).replace(/[.*+?^${}()|[\]\/\\]/g,
"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return function(h){var g=typeof h;return"function"==g?!("prototype"in h)||d.test(l.call(h)):h&&"object"==g&&b.test(e.call(h))||!1}}(),G=function(){var e=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,l=Function,b=function(a,c){return function(f){var b=D.call(arguments),e;b.push(null);b.push(a);if(c){for(e=a.apply(null,b);(void 0===e||"number"==typeof e&&isNaN(e))&&!f.$isRoot;)f=f.$parent,b[0]=f,e=a.apply(null,b);return e}return a.apply(null,
b)}},d={},h=0,g={},n=0,a={},c=0,f=function(){1E3<=h&&(d={});1E3<=n&&(g={});1E3<=c&&(a={})};return{createGetter:function(a){try{return d[a]?d[a]:(h++,d[a]=b(new l("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(e,"$1____.$3"),";} catch (thrownError) { return undefined; }")),!0))}catch(c){return y(c),w}},createSetter:function(a){try{if(!g[a]){n++;var c=a.replace(e,"$1____.$3");return g[a]=b(new l("____","$$$$","$$interceptor","$$itself","".concat("try {",c," = $$$$",";} catch (thrownError) { return undefined; }")))}return g[a]}catch(f){return y(f),
w}},createFunc:function(f){try{return a[f]?a[f]:(c++,a[f]=b(new l("____","$$interceptor","$$itself","".concat("try {",f.replace(e,"$1____.$3"),";} catch (thrownError) { return undefined; }"))))}catch(d){return y(d),w}},resetCache:f,enableResetCacheInterval:function(){setTimeout(f,1E4)}}}(),H=G.createGetter,O=G.createSetter;return function(){var e=Object.observe&&N(Object.observe),l=function(a){if(!t(a))return!0;var c=a.substr(0,1),f=a.length-1;return'"'!=c&&"'"!=c||a.indexOf(c,1)!=f?!1:a.substring(1,
f)},b,d=function(a,c,f,e,d,A){b||(b=new I);var p=C(),m;A&&(this.namespace=A,this.nsGet=A.get);this.origCode=c;t(c)||(e=f,f=c,c=null,m="object");t(a)&&(e=f,f=c,c=a,a=null);c&&a&&(m=a.hasOwnProperty(c)?"attr":"expr");c&&!a&&(m="expr");if(f)b.on(p,f,e||this,{append:[d],allowDupes:!0});if("expr"==m){c=this._processInputPipes(c,a);c=this._processPipes(c,a);if(this.inputPipes||this.pipes)c=g(a,c),m=a.hasOwnProperty(c)?"attr":"expr";if(this.staticValue=l(c))m="static"}this.userData=d;this.code=c;this.id=
p;this.type=m;this.obj=a;"expr"==m&&(this.getterFn=H(c));"static"!=m||this.pipes?(this.curr=this.curr||this._getValue(),this.currCopy=z(this.curr)?this.curr:F(this.curr)):(this.check=K,this.curr=this.prev=this.staticValue)};M(d.prototype,{namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,obsrvDelegate:null,_indexArrayItems:function(a){var c=
"$$"+this.id,f,b,e;if(a)for(f=0,b=a.length;f<b;f++)e=a[f],!e||z(e)||e[c]||(e[c]=C())},_processInputPipes:function(a,c){if(-1==a.indexOf(">>"))return a;for(var f=0,b=a.length,e=[],d,p,m,k=a;f<b&&-1!=(d=a.indexOf(">>",f));)p=a.charAt(d-1),m=a.charAt(d+2),"\\"!=p&&"'"!=p&&'"'!=p&&"'"!=m&&'"'!=m&&(f=r(a.substring(f,d)).split(":"),k=a.substr(d+2),this._addPipe(e,f,c,this.onInputParamChange)),f=d+2;e.length&&(this.inputPipes=e);return r(k)},_addPipe:function(a,c,f,e){var b=c.shift(),d=null,p=[],m;this.nsGet&&
(d=this.nsGet("filter."+b,!0));d||(d=window[b]||f[b]);if(u(d)){b=-1;for(m=c.length;++b<m;p.push(h(f,c[b],e,this,null,this.namespace)));a.push([d,c,p])}},_processPipes:function(a,c){if(-1==a.indexOf("|"))return a;for(var f=0,b=a.length,e=[],d,p,m,k=!1,h=a;f<b;)if(-1!=(d=a.indexOf("|",f)))p=a.charAt(d-1),m=a.charAt(d+1),"|"!=p&&"'"!=p&&'"'!=p&&"|"!=m&&"'"!=m&&'"'!=m&&(k?(f=r(a.substring(f,d)).split(":"),this._addPipe(e,f,c)):(k=!0,h=r(a.substring(0,d)))),f=d+1;else{k&&(f=r(a.substr(f)).split(":"),this._addPipe(e,
f,c,this.onPipeParamChange));break}e.length&&(this.pipes=e);return h},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":a=this.obj}s(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,c){if(c){var f,b,e,d=c.length,h=this.obj,m,k;for(f=0;f<d;f++){e=c[f][1];b=[];m=-1;for(k=
e.length;++m<k;b.push(n(e[m],h)));b.unshift(h);b.unshift(a);a=c[f][0].apply(null,b)}}return a},subscribe:function(a,c,f){b.on(this.id,a,c,f)},unsubscribe:function(a,c){return b.un(this.id,a,c)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,c){var f;c=c||this._getValue();
var b=a||[],e=c||[],d=b.length,h=e.length,m=Array(d+1);f=Array(d+1);var k,g,l,n=0;if(d==h&&0==d)f=[];else{for(k=0;k<=d;k++)m[k]=Array(h+1),f[k]=Array(h+1),m[k][0]=k,f[k][0]="D";for(k=0;k<=h;k++)m[0][k]=k,f[0][k]="I";for(k=1;k<=d;k++)for(g=1;g<=h;g++)l=E(b[k-1],e[g-1])?0:1,m[k][g-1]<m[k-1][g]&&m[k][g-1]<m[k-1][g-1]+l?(m[k][g]=m[k][g-1]+1,f[k][g]="I"):m[k-1][g]<m[k-1][g-1]+l?(m[k][g]=m[k-1][g]+1,f[k][g]="D"):(m[k][g]=m[k-1][g-1]+l,f[k][g]=1==l?"R":"-");b=[];k=d;g=h;do d=f[k][g],b.push(d),"-"!=d&&n++,
"R"==d||"-"==d?(k--,g--):"D"==d?k--:g--;while(0!=k||0!=g);f=b.reverse()}return f},getMovePrescription:function(a,c,f){f=f||this._getValue();var b=a||[],e=f||[];a=this.getPrescription(a||[],f||[]);f=[];var d,g,h,k={},l,n;d=0;for(g=b.length;d<g;d++)(h=c(b[d]))&&(k[h]=d);l=0;var q={};d=0;for(g=a.length;d<g;d++)b=a[d],"D"!=b&&(h=c(e[l]),void 0!=h&&!0!==q[h]&&void 0!==(n=k[h])?(f.push(n),q[h]=!0):f.push(b),l++);return f},setValue:function(a){var c=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,
this.inputPipes);"attr"==c?this.obj[this.code]=a:"expr"==c?(this.setterFn||(this.setterFn=O(this.code)),this.setterFn(this.obj,a)):"object"==c&&(this.obj=a)},onInputParamChange:function(a,c,f){this.setValue(this.lastSetValue);f&&this.checkAll()},onPipeParamChange:function(a,c,f){this.check()},_check:function(a){var c=this._getValue(),f=this.currCopy;return E(f,c)?!1:(this.curr=c,this.prev=f,this.currCopy=z(c)?c:F(c),b.trigger(this.id,c,f,a),!0)},check:function(a){return this._check(a)},checkAll:function(){return this.obj.$$watchers.$checkAll()},
getLastResult:function(){return this.curr},setInterval:function(a){var c=this;c.itv&&c.clearInterval();c.itv=setInterval(function(){c.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,c){var f=this.id;a&&b.un(f,a,c);return b.hasListener(f)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,c=this.inputPipes,f,d,e,g,h;this.itv&&this.clearInterval();if(a)for(f=-1,d=a.length;++f<d;)for(h=a[f][2],e=-1,g=h.length;++e<g;)h[e].unsubscribeAndDestroy(this.check,
this);if(c)for(f=-1,d=c.length;++f<d;)for(h=c[f][2],e=-1,g=h.length;++e<g;)h[e].unsubscribeAndDestroy(this.onInputParamChange,this);this.obsrvDelegate&&Object.unobserve(this.obj,this.obsrvDelegate);this.obj&&delete this.obj.$$watchers.$codes[this.origCode];b.destroyEvent(this.id);for(f in this)this.hasOwnProperty(f)&&(this[f]=null)}},!0,!1);var h=function(a,c,f,b,e,h){c=g(a,r(c));return a?(a.$$watchers||(a.$$watchers={$codes:{},$checkAll:function(){var a=this.$codes,c,b=0;for(c in a)a[c].check()&&
b++;return b},$destroyAll:function(){var a=this.$codes,c;for(c in a)a[c].destroy(),delete a[c]}}),a.$$watchers.$codes[c]?a.$$watchers.$codes[c].subscribe(f,b,{append:[e],allowDupes:!0}):a.$$watchers.$codes[c]=new d(a,c,f,b,e,h),a.$$watchers.$codes[c]):new d(a,c,f,b,e,h)},g=function(a,c){if(a&&c){if(a.hasOwnProperty(c))return c;var b;if("."==c.charAt(0)&&(b=c.substr(1),a.hasOwnProperty(b)))return b}return c},n=function(a,c){var b;return(b=l(a))?b:H(a)(c)};d.create=h;d.unsubscribeAndDestroy=function(a,
b,d,e){b=r(b);(a=a.$$watchers?a.$$watchers.$codes:null)&&a[b]&&a[b].unsubscribeAndDestroy(d,e)&&delete a[b]};d.normalizeExpr=g;d.eval=n;d.usesNativeObserver=function(){return e};return d}()});
