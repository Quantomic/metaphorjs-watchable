define("metaphorjs-watchable",["metaphorjs-observable"],function(G){var z=function(){var b=["0","0","0"];return function(){for(var d=b.length,c;d;){d--;c=b[d].charCodeAt(0);if(57==c)return b[d]="A",b.join("");if(90==c)b[d]="0";else return b[d]=String.fromCharCode(c+1),b.join("")}b.unshift("0");return b.join("")}}(),H=Object.prototype.toString,n=function(){var b={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,
"[object Date]":10};return function(d){if(!d){if(null===d)return 6;if(void 0===d)return 7}var c=b[H.call(d)];return void 0===c?-1:1==c&&isNaN(d)?8:c}}(),q=function(b){return"object"==typeof b&&5===n(b)},u=function(b){return"function"==typeof b},r=function(b){return"string"==typeof b||b===""+b},p=function(){return String.prototype.trim?function(b){return r(b)?b.trim():b}:function(b){return r(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),s=function(){},A=Array.prototype.slice,w=function(b){return b===
window||b&&b.document&&b.location&&b.alert&&b.setInterval},B=function(){var b=function(d,c){if(d===c)return!0;if(null===d||null===c)return!1;if(d!==d&&c!==c)return!0;var h=typeof d,l;if(h==typeof c&&"object"==h)if(q(d)){if(!q(c))return!1;if((h=d.length)==c.length){for(l=0;l<h;l++)if(!b(d[l],c[l]))return!1;return!0}}else{if(10===n(d))return 10===n(c)&&d.getTime()==c.getTime();if(9===n(d)&&9===n(c))return d.toString()==c.toString();if(w(d)||w(c)||q(c))return!1;h={};for(l in d)if("$"!=l.charAt(0)&&!u(d[l])){if(!b(d[l],
c[l]))return!1;h[l]=!0}for(l in c)if(!h.hasOwnProperty(l)&&"$"!=l.charAt(0)&&void 0!==c[l]&&!u(c[l]))return!1;return!0}return!1};return b}(),C=function(){var b=function(d,c){if(w(d))throw Error("Cannot copy window object");if(c){if(d===c)throw Error("Objects are identical");if(q(d))for(var h=c.length=0,l=d.length;h<l;h++)c.push(b(d[h]));else{for(h in c)delete c[h];for(h in d)d.hasOwnProperty(h)&&("$"==h.charAt(0)||u(d[h])?c[h]=d[h]:c[h]=b(d[h]))}}else(c=d)&&(q(d)?c=b(d,[]):10===n(d)?c=new Date(d.getTime()):
9===n(d)?c=new RegExp(d.source):"object"!=typeof d||3!==n(d)||d.nodeType||(c=b(d,{})));return c};return b}(),I=function(b,d,c,h){setTimeout(function(){b.apply(d,c||[])},h||0)},v=function(b){var d=b.stack||Error().stack;if("undefined"!=typeof console&&console.log)I(function(){console.log(b);d&&console.log(d)});else throw b;},x=function(b){b=n(b);return 3>b&&-1<b},E=function(){var b=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,d=Function,c=function(a,f,e,g){for(;e&&!e.$isRoot;)if(e=e.$parent)try{return 4==arguments.length?
f.call(null,e,g,s,f):f.call(null,e,s,f)}catch(d){}null!==a&&v(a)},h=function(a,f){return function(){var e=A.call(arguments);e.push(c);e.push(a);e=a.apply(null,e);return f&&(void 0===e||"number"==typeof e&&isNaN(e))?(e=A.call(arguments),e.unshift(a),e.unshift(null),c.apply(null,e)):e}},l={},n=0,a={},f=0,g={},D=0,t=function(){1E3<=n&&(l={});1E3<=f&&(a={});1E3<=D&&(g={})};return{createGetter:function(a){try{return l[a]?l[a]:(n++,l[a]=h(new d("____","$$interceptor","$$itself","".concat("try {","return ",
a.replace(b,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }")),!0))}catch(f){return v(f),s}},createSetter:function(g){try{if(!a[g]){f++;var k=g.replace(b,"$1____.$3");return a[g]=h(new d("____","$$$$","$$interceptor","$$itself","".concat("try {",k," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return a[g]}catch(e){return v(e),s}},createFunc:function(a){try{return g[a]?g[a]:(D++,g[a]=h(new d("____","$$interceptor",
"$$itself","".concat("try {",a.replace(b,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(f){return v(f),s}},resetCache:t,enableResetCacheInterval:function(){setTimeout(t,1E4)}}}(),F=E.createGetter,J=E.createSetter;return function(){var b=function(a){if(!r(a))return!0;var f=a.substr(0,1),g=a.length-1;return'"'!=f&&"'"!=f||a.indexOf(f,1)!=g?!1:a.substring(1,g)},d,c=function(a,f,g,c,t,y){d||(d=new G);var k=z(),e;y&&(this.namespace=y,this.nsGet=y.get);
this.origCode=f;r(f)||(c=g,g=f,f=null,e="object");r(a)&&(c=g,g=f,f=a,a=null);f&&a&&(e=a.hasOwnProperty(f)?"attr":"expr");f&&!a&&(e="expr");if(g)d.on(k,g,c||this,{append:[t],allowDupes:!0});if("expr"==e){f=this._processInputPipes(f,a);f=this._processPipes(f,a);if(this.inputPipes||this.pipes)f=l(a,f),e=a.hasOwnProperty(f)?"attr":"expr";if(this.staticValue=b(f))e="static"}this.userData=t;this.code=f;this.id=k;this.type=e;this.obj=a;"expr"==e&&(this.getterFn=F(f));this.curr=this._getValue();this.currCopy=
x(this.curr)?this.curr:C(this.curr)};c.prototype={namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,currCopy:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,_indexArrayItems:function(a){var f="$$"+this.id,g,d,b;if(a)for(g=0,d=a.length;g<d;g++)b=a[g],!b||x(b)||b[f]||(b[f]=z())},_processInputPipes:function(a,f){if(-1==a.indexOf(">>"))return a;for(var g=0,d=a.length,b=
[],c,k,e,m=a;g<d&&-1!=(c=a.indexOf(">>",g));)k=a.charAt(c-1),e=a.charAt(c+2),"\\"!=k&&"'"!=k&&'"'!=k&&"'"!=e&&'"'!=e&&(g=p(a.substring(g,c)).split(":"),m=a.substr(c+2),this._addPipe(b,g,f,this.onInputParamChange)),g=c+2;b.length&&(this.inputPipes=b);return p(m)},_addPipe:function(a,f,g,d){var b=f.shift(),c=null,k=[],e;this.nsGet&&(c=this.nsGet("filter."+b,!0));c||(c=window[b]||g[b]);if(u(c)){b=-1;for(e=f.length;++b<e;k.push(h(g,f[b],d,this,null,this.namespace)));a.push([c,f,k])}},_processPipes:function(a,
f){if(-1==a.indexOf("|"))return a;for(var g=0,b=a.length,d=[],c,k,e,m=!1,h=a;g<b;)if(-1!=(c=a.indexOf("|",g)))k=a.charAt(c-1),e=a.charAt(c+1),"|"!=k&&"'"!=k&&'"'!=k&&"|"!=e&&"'"!=e&&'"'!=e&&(m?(g=p(a.substring(g,c)).split(":"),this._addPipe(d,g,f)):(m=!0,h=p(a.substring(0,c)))),g=c+1;else{m&&(g=p(a.substr(g)).split(":"),this._addPipe(d,g,f,this.onPipeParamChange));break}d.length&&(this.pipes=d);return h},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=
this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":a=this.obj}q(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,f){if(f){var g,d,b,c=f.length,k=this.obj,e,m;for(g=0;g<c;g++){b=f[g][1];d=[];e=-1;for(m=b.length;++e<m;d.push(n(b[e],k)));d.unshift(k);d.unshift(a);a=f[g][0].apply(null,d)}}return a},subscribe:function(a,f,g){d.on(this.id,a,f,g)},unsubscribe:function(a,
f){return d.un(this.id,a,f)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return this.prev},getPrescription:function(a,f){var g;f=f||this._getValue();var d=f,b=a.length,c=d.length,k=Array(b+1);g=Array(b+1);var e,m,h,l=0;if(b==c&&0==b)g=[];else{for(e=0;e<=b;e++)k[e]=Array(c+1),g[e]=Array(c+1),k[e][0]=e,g[e][0]=
"D";for(e=0;e<=c;e++)k[0][e]=e,g[0][e]="I";for(e=1;e<=b;e++)for(m=1;m<=c;m++)h=B(a[e-1],d[m-1])?0:1,k[e][m-1]<k[e-1][m]&&k[e][m-1]<k[e-1][m-1]+h?(k[e][m]=k[e][m-1]+1,g[e][m]="I"):k[e-1][m]<k[e-1][m-1]+h?(k[e][m]=k[e-1][m]+1,g[e][m]="D"):(k[e][m]=k[e-1][m-1]+h,g[e][m]=1==h?"R":"-");d=[];e=b;m=c;do b=g[e][m],d.push(b),"-"!=b&&l++,"R"==b||"-"==b?(e--,m--):"D"==b?e--:m--;while(0!=e||0!=m);g=d.reverse()}return g},getMovePrescription:function(a,f,b){var d=b=b||this._getValue();b=this.getPrescription(a,
b);var c=[],h,k,e,m={},l,n;h=0;for(k=a.length;h<k;h++)(e=f(a[h]))&&(m[e]=h);l=0;var p={};h=0;for(k=b.length;h<k;h++)a=b[h],"D"!=a&&(e=f(d[l]),void 0!=e&&!0!==p[e]&&void 0!==(n=m[e])?(c.push(n),p[e]=!0):c.push(a),l++);return c},setValue:function(a){var f=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);"attr"==f?this.obj[this.code]=a:"expr"==f?(this.setterFn||(this.setterFn=J(this.code)),this.setterFn(this.obj,a)):"object"==f&&(this.obj=a)},onInputParamChange:function(){this.setValue(this.lastSetValue)},
onPipeParamChange:function(){this.check()},check:function(){var a=this._getValue(),f=this.currCopy;return B(f,a)?!1:(this.curr=a,this.prev=f,this.currCopy=x(a)?a:C(a),d.trigger(this.id,a,f),!0)},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var f=this;f.itv&&f.clearInterval();f.itv=setInterval(function(){f.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,
f){var b=this.id;a&&d.un(b,a,f);return d.hasListener(b)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,c,h,l,n,k;this.itv&&this.clearInterval();if(a)for(c=-1,h=a.length;++c<h;)for(k=a[c][2],l=-1,n=k.length;++l<n;)k[l].unsubscribeAndDestroy(this.check,this);if(b)for(c=-1,h=b.length;++c<h;)for(k=b[c][2],l=-1,n=k.length;++l<n;)k[l].unsubscribeAndDestroy(this.onInputParamChange,this);this.obj&&delete this.obj.$$watchers[this.origCode];delete this.id;delete this.curr;delete this.prev;
delete this.unfiltered;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;delete this.namespace;delete this.nsGet;d.destroyEvent(this.id)}};var h=function(a,b,d,h,n,q){b=l(a,p(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&this[a]instanceof c&&this[a].check()&&
b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof c)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].subscribe(d,h,{append:[n],allowDupes:!0}):a.$$watchers[b]=new c(a,b,d,h,n,q),a.$$watchers[b]):new c(a,b,d,h,n,q)},l=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},n=function(a,c){var d;return(d=b(a))?d:F(a)(c)};c.create=h;c.unsubscribeAndDestroy=function(a,
b,c,d){b=p(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&delete a[b]};c.normalizeExpr=l;c.eval=n;return c}()});
