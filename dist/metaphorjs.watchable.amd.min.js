define("metaphorjs-watchable",["metaphorjs-observable"],function(N){var E=function(){var d=["0","0","0"];return function(){for(var e=d.length,f;e;){e--;f=d[e].charCodeAt(0);if(57==f)return d[e]="A",d.join("");if(90==f)d[e]="0";else return d[e]=String.fromCharCode(f+1),d.join("")}d.unshift("0");return d.join("")}}(),y=Object.prototype.toString,p=function(){var d={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,
"[object Date]":10};return function(e){if(!e){if(null===e)return 6;if(void 0===e)return 7}var f=d[y.call(e)];if(void 0===f)return-1;1==f&&isNaN(e)&&(f=8);return f}}(),q=function(d){return 5===p(d)},r=function(){return String.prototype.trim?function(d){return 0===p(d)?d.trim():d}:function(d){return 0===p(d)?d.replace(/^\s\s*/,"").replace(/\s\s*$/,""):d}}(),t=function(){},F=Array.prototype.slice,s=function(d){return d&&d.document&&d.location&&d.alert&&d.setInterval},z=function(){var d=function(e,f){if(e===
f)return!0;if(null===e||null===f)return!1;if(e!==e&&f!==f)return!0;var m=typeof e,k;if(m==typeof f&&"object"==m)if(q(e)){if(!q(f))return!1;if((m=e.length)==f.length){for(k=0;k<m;k++)if(!d(e[k],f[k]))return!1;return!0}}else{if(10===p(e))return 10===p(f)&&e.getTime()==f.getTime();if(9===p(e)&&9===p(f))return e.toString()==f.toString();if(s(e)||s(f)||q(f))return!1;m={};for(k in e)if(("$"!==k.charAt(0)||"object"!=typeof e[k])&&"function"!=typeof e[k]){if(!d(e[k],f[k]))return!1;m[k]=!0}for(k in f)if(!m.hasOwnProperty(k)&&
"$"!==k.charAt(0)&&void 0!==f[k]&&"function"!=typeof f[k])return!1;return!0}return!1};return d}(),G=function(){var d=function(e,f){if(s(e))throw Error("Cannot copy window object");if(f){if(e===f)throw Error("Objects are identical");if(q(e))for(var m=f.length=0;m<e.length;m++)f.push(d(e[m]));else{for(m in f)delete f[m];for(m in e)f[m]=d(e[m])}}else if(f=e)q(e)?f=d(e,[]):10===p(e)?f=new Date(e.getTime()):9===p(e)?f=new RegExp(e.source):(m=p(e),null!==e&&"object"==typeof e&&(2<m||-1==m)&&(f=d(e,{})));
return f};return d}(),O=function(d,e,f){setTimeout(function(){d.apply(e,f||[])},0)},u=function(d){var e=d.stack||Error().stack;if("undefined"!=typeof console&&console.log)O(function(){console.log(d);e&&console.log(e)});else throw d;};return function(){var d=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,e=function(a){if(0!==p(a))return!0;var b=a.substr(0,1),c=a.length-1;return'"'!=b&&"'"!=b||a.indexOf(b,1)!=c?!1:a.substring(1,c)},f=function(a,b){var c=a.length,e=b.length,n=Array(c+1),l=Array(c+1),g,h,d,f,k=0;if(c==
e&&0==c)return{changes:0,distance:0,prescription:[]};for(g=0;g<=c;g++)n[g]=Array(e+1),l[g]=Array(e+1),n[g][0]=g,l[g][0]="D";for(g=0;g<=e;g++)n[0][g]=g,l[0][g]="I";for(g=1;g<=c;g++)for(h=1;h<=e;h++)d=z(a[g-1],b[h-1])?0:1,n[g][h-1]<n[g-1][h]&&n[g][h-1]<n[g-1][h-1]+d?(n[g][h]=n[g][h-1]+1,l[g][h]="I"):n[g-1][h]<n[g-1][h-1]+d?(n[g][h]=n[g-1][h]+1,l[g][h]="D"):(n[g][h]=n[g-1][h-1]+d,l[g][h]=1==d?"R":"-");f=[];g=c;h=e;do d=l[g][h],f.push(d),"-"!=d&&k++,"R"==d||"-"==d?(g--,h--):"D"==d?g--:h--;while(0!=g||
0!=h);return{changes:k/f.length,distance:n[c][e],prescription:f.reverse()}},m,k=function(a,b,c,d,n,l){m||(m=new N);var g=E(),h;l&&(this.namespace=l,this.nsGet=l.get);this.origCode=b;q(a)&&null===b?h="array":(0!==p(b)&&(d=c,c=b,b=null,h="object"),0===p(a)&&(d=c,c=b,b=a,a=null),b&&a&&(h=a.hasOwnProperty(b)?"attr":"expr"),b&&!a&&(h="expr"));if(c)m.on(g,c,d||this,{append:[n],allowDupes:!0});if("expr"==h){b=this._processInputPipes(b,a);b=this._processPipes(b,a);if(this.inputPipes||this.pipes)b=A(a,b),
h=a.hasOwnProperty(b)?"attr":"expr";if(this.staticValue=e(b))h="static"}this.userData=n;this.code=b;this.id=g;this.type=h;this.obj=a;"expr"==h&&(this.getterFn=B(b));this.curr=this._getValue()};k.prototype={namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,_indexArrayItems:function(a){var b="$$"+this.id,c,e,d;if(a)for(c=0,e=
a.length;c<e;c++){d=a[c];var l;if(l=d)l=p(d),l=!(3>l&&-1<l);l&&!d[b]&&(d[b]=E())}},_processInputPipes:function(a,b){if(-1==a.indexOf(">>"))return a;for(var c=0,d=a.length,e=[],l,g,h,f=a;c<d&&-1!=(l=a.indexOf(">>",c));)g=a.charAt(l-1),h=a.charAt(l+2),"\\"!=g&&"'"!=g&&'"'!=g&&"'"!=h&&'"'!=h&&(c=r(a.substring(c,l)).split(":"),f=a.substr(l+2),this._addPipe(e,c,b,this.onInputParamChange)),c=l+2;e.length&&(this.inputPipes=e);return r(f)},_addPipe:function(a,b,c,d){var e=b.shift(),l=null,g=[],h;this.nsGet&&
(l=this.nsGet("filter."+e,!0));l||(l=window[e]||c[e]);if("function"==typeof l){e=-1;for(h=b.length;++e<h;g.push(s(c,b[e],d,this,null,this.namespace)));a.push([l,b,g])}},_processPipes:function(a,b){if(-1==a.indexOf("|"))return a;for(var c=0,e=a.length,d=[],l,g,h,f=!1,k=a;c<e;)if(-1!=(l=a.indexOf("|",c)))g=a.charAt(l-1),h=a.charAt(l+1),"|"!=g&&"'"!=g&&'"'!=g&&"|"!=h&&"'"!=h&&'"'!=h&&(f?(c=r(a.substring(c,l)).split(":"),this._addPipe(d,c,b)):(f=!0,k=r(a.substring(0,l)))),c=l+1;else{f&&(c=r(a.substr(c)).split(":"),
this._addPipe(d,c,b,this.onPipeParamChange));break}d.length&&(this.pipes=d);return k},_checkCode:function(){var a=this._getValue(),b=!1,c=this.curr;if(q(c)&&q(a))return b=f(c,a),b.changes?(this.curr=a.slice(),this.prev=c,m.trigger(this.id,b,a,c),!0):!1;z(c,a)||(this.curr=a,this.prev=c,m.trigger(this.id,a,c),b=!0);return b},_checkObject:function(){var a=this.obj,b=this.curr;return z(b,a)?!1:(this.curr=G(a),this.prev=b,m.trigger(this.id,a,b),!0)},_checkArray:function(){var a=this.curr,b=this.obj,c=
f(a,b);return c.changes?(this.curr=b.slice(),this.prev=a,m.trigger(this.id,c,b,a),!0):!1},_getValue:function(){var a;switch(this.type){case "static":a=this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);void 0===a&&(a="");break;case "object":a=G(this.obj);break;case "array":a=this.obj}q(a)&&(this.inputPipes||this._indexArrayItems(a),a=a.slice());this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,b){if(b){var c,
e,d,f=b.length,g=this.obj,h,k;for(c=0;c<f;c++){d=b[c][1];e=[];h=-1;for(k=d.length;++h<k;e.push(H(d[h],g)));e.unshift(g);e.unshift(a);a=b[c][0].apply(null,e)}}return a},subscribe:function(a,b,c){m.on(this.id,a,b,c)},unsubscribe:function(a,b){return m.un(this.id,a,b)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return null===
this.prev?this._getValue():this.prev},getMovePrescription:function(a,b){var c=this.getPrevValue(),e=this.curr,d=[],f,g,h={},k,m,p;f=0;for(g=c.length;f<g;f++)h[b(c[f])]=f;m=0;var q={};k=0;for(g=a.length;k<g;k++)f=a[k],"D"!=f&&(c=b(e[m]),void 0!==c&&!0!==q[c]&&void 0!==(p=h[c])?(d.push(p),q[c]=!0):d.push(f),m++);return d},setValue:function(a){var b=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);if("attr"==b)this.obj[this.code]=a;else if("expr"==b)this.setterFn||(this.setterFn=
I(this.code)),this.setterFn(this.obj,a);else if("array"==b)this.obj=a;else throw"Cannot set value";},onInputParamChange:function(){this.setValue(this.lastSetValue)},onPipeParamChange:function(){this.check()},check:function(){switch(this.type){case "expr":case "attr":case "static":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=
this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var c=this.id;a&&m.un(c,a,b);return m.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,c,e,d,f,g;this.itv&&this.clearInterval();if(a)for(c=-1,e=a.length;++c<e;)for(g=a[c][2],d=-1,f=g.length;++d<f;)g[d].unsubscribeAndDestroy(this.check,this);if(b)for(c=-1,e=b.length;++c<e;)for(g=
b[c][2],d=-1,f=g.length;++d<f;)g[d].unsubscribeAndDestroy(this.onInputParamChange,this);this.obj&&delete this.obj.$$watchers[this.origCode];delete this.id;delete this.curr;delete this.prev;delete this.unfiltered;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;delete this.namespace;delete this.nsGet;m.destroyEvent(this.id)}};var s=function(a,
b,c,d,e,f){b=A(a,r(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&this[a]instanceof k&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof k)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].subscribe(c,d,{append:[e],allowDupes:!0}):a.$$watchers[b]=new k(a,b,c,d,e,f),a.$$watchers[b]):new k(a,b,c,d,e,f)},A=function(a,b){if(a&&
b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},C=Function,J=function(a,b,c,d){for(;c&&!c.$isRoot;)if(c=c.$parent)try{return 4==arguments.length?b.call(null,c,d,t,b):b.call(null,c,t,b)}catch(e){}null!==a&&u(a)},D=function(a,b){return function(){var c=F.call(arguments);c.push(J);c.push(a);c=a.apply(null,c);if(!b||void 0!==c&&8!=p(c))return c;c=F.call(arguments);c.unshift(a);c.unshift(null);return J.apply(null,c)}},v={},K=0,B=function(a){try{return v[a]?
v[a]:(K++,v[a]=D(new C("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(d,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }")),!0))}catch(b){return u(b),t}},w={},L=0,I=function(a){try{if(!w[a]){L++;var b=a.replace(d,"$1____.$3");return w[a]=D(new C("____","$$$$","$$interceptor","$$itself","".concat("try {",b," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return w[a]}catch(c){return u(c),
t}},x={},M=0,H=function(a,b){var c;return(c=e(a))?c:B(a)(b)},y=function(){1E3<=K&&(v={});1E3<=L&&(w={});1E3<=M&&(x={})};k.create=s;k.unsubscribeAndDestroy=function(a,b,c,d){b=r(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&delete a[b]};k.normalizeExpr=A;k.prepareCode=function(a){return a.replace(d,"$1____.$3")};k.createGetter=B;k.createSetter=I;k.createFunc=function(a){try{return x[a]?x[a]:(M++,x[a]=D(new C("____","$$interceptor","$$itself","".concat("try {",a.replace(d,"$1____.$3"),
";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(b){return u(b),t}};k.eval=H;k.enableResetCacheInterval=function(){setTimeout(y,1E4)};return k}()});
