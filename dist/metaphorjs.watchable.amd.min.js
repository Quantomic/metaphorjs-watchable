define("metaphorjs-watchable",["metaphorjs-observable"],function(M){var C=function(){var c=["0","0","0"];return function(){for(var b=c.length,e;b;){b--;e=c[b].charCodeAt(0);if(57==e)return c[b]="A",c.join("");if(90==e)c[b]="0";else return c[b]=String.fromCharCode(e+1),c.join("")}c.unshift("0");return c.join("")}}(),y=Object.prototype.toString,m=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,
"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var e=c[y.call(b)];return void 0===e?-1:1==e&&isNaN(b)?8:e}}(),r=function(c){return"object"==typeof c&&5===m(c)},s=function(c){return"string"==typeof c||c===""+c},p=function(){return String.prototype.trim?function(c){return s(c)?c.trim():c}:function(c){return s(c)?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),t=function(){},D=Array.prototype.slice,q=function(c){return c===window||c&&c.document&&c.location&&
c.alert&&c.setInterval},E=function(){var c=function(b,e){if(b===e)return!0;if(null===b||null===e)return!1;if(b!==b&&e!==e)return!0;var g=typeof b,l;if(g==typeof e&&"object"==g)if(r(b)){if(!r(e))return!1;if((g=b.length)==e.length){for(l=0;l<g;l++)if(!c(b[l],e[l]))return!1;return!0}}else{if(10===m(b))return 10===m(e)&&b.getTime()==e.getTime();if(9===m(b)&&9===m(e))return b.toString()==e.toString();if(q(b)||q(e)||r(e))return!1;g={};for(l in b)if("$"!=l.charAt(0)&&"function"!=typeof b[l]){if(!c(b[l],
e[l]))return!1;g[l]=!0}for(l in e)if(!g.hasOwnProperty(l)&&"$"!=l.charAt(0)&&void 0!==e[l]&&"function"!=typeof e[l])return!1;return!0}return!1};return c}(),N=function(){var c=function(b,e){if(q(b))throw Error("Cannot copy window object");if(e){if(b===e)throw Error("Objects are identical");if(r(b))for(var g=e.length=0,l=b.length;g<l;g++)e.push(c(b[g]));else{for(g in e)delete e[g];for(g in b)e[g]=c(b[g])}}else(e=b)&&(r(b)?e=c(b,[]):10===m(b)?e=new Date(b.getTime()):9===m(b)?e=new RegExp(b.source):"object"!=
typeof b||3!==m(b)||b.nodeType||(e=c(b,{})));return e};return c}(),O=function(c,b,e,g){setTimeout(function(){c.apply(b,e||[])},g||0)},u=function(c){var b=c.stack||Error().stack;if("undefined"!=typeof console&&console.log)O(function(){console.log(c);b&&console.log(b)});else throw c;},F=function(c){c=m(c);return 3>c&&-1<c};return function(){var c=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,b=function(a){if(!s(a))return!0;var d=a.substr(0,1),f=a.length-1;return'"'!=d&&"'"!=d||a.indexOf(d,1)!=f?!1:a.substring(1,
f)},e,g=function(a,d,f,c,n,z){e||(e=new M);var k=C(),h;z&&(this.namespace=z,this.nsGet=z.get);this.origCode=d;s(d)||(c=f,f=d,d=null,h="object");s(a)&&(c=f,f=d,d=a,a=null);d&&a&&(h=a.hasOwnProperty(d)?"attr":"expr");d&&!a&&(h="expr");if(f)e.on(k,f,c||this,{append:[n],allowDupes:!0});if("expr"==h){d=this._processInputPipes(d,a);d=this._processPipes(d,a);if(this.inputPipes||this.pipes)d=m(a,d),h=a.hasOwnProperty(d)?"attr":"expr";if(this.staticValue=b(d))h="static"}this.userData=n;this.code=d;this.id=
k;this.type=h;this.obj=a;"expr"==h&&(this.getterFn=A(d));this.curr=this._getValue()};g.prototype={namespace:null,nsGet:null,staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,prev:null,unfiltered:null,pipes:null,inputPipes:null,lastSetValue:null,userData:null,_indexArrayItems:function(a){var d="$$"+this.id,f,c,n;if(a)for(f=0,c=a.length;f<c;f++)n=a[f],!n||F(n)||n[d]||(n[d]=C())},_processInputPipes:function(a,d){if(-1==a.indexOf(">>"))return a;
for(var f=0,c=a.length,n=[],b,k,h,e=a;f<c&&-1!=(b=a.indexOf(">>",f));)k=a.charAt(b-1),h=a.charAt(b+2),"\\"!=k&&"'"!=k&&'"'!=k&&"'"!=h&&'"'!=h&&(f=p(a.substring(f,b)).split(":"),e=a.substr(b+2),this._addPipe(n,f,d,this.onInputParamChange)),f=b+2;n.length&&(this.inputPipes=n);return p(e)},_addPipe:function(a,d,f,c){var b=d.shift(),e=null,k=[],h;this.nsGet&&(e=this.nsGet("filter."+b,!0));e||(e=window[b]||f[b]);if("function"==typeof e){b=-1;for(h=d.length;++b<h;k.push(l(f,d[b],c,this,null,this.namespace)));
a.push([e,d,k])}},_processPipes:function(a,d){if(-1==a.indexOf("|"))return a;for(var f=0,c=a.length,b=[],e,k,h,g=!1,l=a;f<c;)if(-1!=(e=a.indexOf("|",f)))k=a.charAt(e-1),h=a.charAt(e+1),"|"!=k&&"'"!=k&&'"'!=k&&"|"!=h&&"'"!=h&&'"'!=h&&(g?(f=p(a.substring(f,e)).split(":"),this._addPipe(b,f,d)):(g=!0,l=p(a.substring(0,e)))),f=e+1;else{g&&(f=p(a.substr(f)).split(":"),this._addPipe(b,f,d,this.onPipeParamChange));break}b.length&&(this.pipes=b);return l},_getValue:function(){var a;switch(this.type){case "static":a=
this.staticValue;break;case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);void 0===a&&(a="");break;case "object":a=this.obj}r(a)&&(this.inputPipes||this._indexArrayItems(a));F(a)||(a=N(a));this.unfiltered=a;return a=this._runThroughPipes(a,this.pipes)},_runThroughPipes:function(a,d){if(d){var f,b,c,e=d.length,k=this.obj,h,g;for(f=0;f<e;f++){c=d[f][1];b=[];h=-1;for(g=c.length;++h<g;b.push(G(c[h],k)));b.unshift(k);b.unshift(a);a=d[f][0].apply(null,b)}}return a},subscribe:function(a,
d,f){e.on(this.id,a,d,f)},unsubscribe:function(a,d){return e.un(this.id,a,d)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},getUnfilteredValue:function(){return this.unfiltered||this.curr},getPrevValue:function(){return null===this.prev?this._getValue():this.prev},getPrescription:function(a,d){var f;d=d||this._getValue();var b=d,c=a.length,e=b.length,k=Array(c+1);f=Array(c+1);var h,g,l,m=0;if(c==e&&
0==c)f=[];else{for(h=0;h<=c;h++)k[h]=Array(e+1),f[h]=Array(e+1),k[h][0]=h,f[h][0]="D";for(h=0;h<=e;h++)k[0][h]=h,f[0][h]="I";for(h=1;h<=c;h++)for(g=1;g<=e;g++)l=E(a[h-1],b[g-1])?0:1,k[h][g-1]<k[h-1][g]&&k[h][g-1]<k[h-1][g-1]+l?(k[h][g]=k[h][g-1]+1,f[h][g]="I"):k[h-1][g]<k[h-1][g-1]+l?(k[h][g]=k[h-1][g]+1,f[h][g]="D"):(k[h][g]=k[h-1][g-1]+l,f[h][g]=1==l?"R":"-");b=[];h=c;g=e;do c=f[h][g],b.push(c),"-"!=c&&m++,"R"==c||"-"==c?(h--,g--):"D"==c?h--:g--;while(0!=h||0!=g);f=b.reverse()}return f},getMovePrescription:function(a,
d,f){var c=f=f||this._getValue();f=this.getPrescription(a,f);var b=[],e,g,h,l={},m,p;e=0;for(g=a.length;e<g;e++)(h=d(a[e]))&&(l[h]=e);m=0;var q={};e=0;for(g=f.length;e<g;e++)a=f[e],"D"!=a&&(h=d(c[m]),void 0!=h&&!0!==q[h]&&void 0!==(p=l[h])?(b.push(p),q[h]=!0):b.push(a),m++);return b},setValue:function(a){var d=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);"attr"==d?this.obj[this.code]=a:"expr"==d?(this.setterFn||(this.setterFn=H(this.code)),this.setterFn(this.obj,a)):"object"==
d&&(this.obj=a)},onInputParamChange:function(){this.setValue(this.lastSetValue)},onPipeParamChange:function(){this.check()},check:function(){var a=this._getValue(),d=this.curr;return E(d,a)?!1:(this.curr=a,this.prev=d,e.trigger(this.id,a,d),!0)},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var d=this;d.itv&&d.clearInterval();d.itv=setInterval(function(){d.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),
this.itv=null)},unsubscribeAndDestroy:function(a,d){var f=this.id;a&&e.un(f,a,d);return e.hasListener(f)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,d=this.inputPipes,f,c,b,g,k;this.itv&&this.clearInterval();if(a)for(f=-1,c=a.length;++f<c;)for(k=a[f][2],b=-1,g=k.length;++b<g;)k[b].unsubscribeAndDestroy(this.check,this);if(d)for(f=-1,c=d.length;++f<c;)for(k=d[f][2],b=-1,g=k.length;++b<g;)k[b].unsubscribeAndDestroy(this.onInputParamChange,this);this.obj&&delete this.obj.$$watchers[this.origCode];
delete this.id;delete this.curr;delete this.prev;delete this.unfiltered;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;delete this.namespace;delete this.nsGet;e.destroyEvent(this.id)}};var l=function(a,d,f,b,c,e){d=m(a,p(d));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,d=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?
d++:"$"==a.charAt(0)&&this[a]instanceof g&&this[a].check()&&d++;return d},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof g)this[a].destroy(),delete this[a]}}),a.$$watchers[d]?a.$$watchers[d].subscribe(f,b,{append:[c],allowDupes:!0}):a.$$watchers[d]=new g(a,d,f,b,c,e),a.$$watchers[d]):new g(a,d,f,b,c,e)},m=function(a,d){if(a&&d){if(a.hasOwnProperty(d))return d;var f;if("."==d.charAt(0)&&(f=d.substr(1),a.hasOwnProperty(f)))return f}return d},q=Function,I=function(a,
d,f,b){for(;f&&!f.$isRoot;)if(f=f.$parent)try{return 4==arguments.length?d.call(null,f,b,t,d):d.call(null,f,t,d)}catch(c){}null!==a&&u(a)},B=function(a,d){return function(){var b=D.call(arguments);b.push(I);b.push(a);b=a.apply(null,b);return d&&void 0===b?(b=D.call(arguments),b.unshift(a),b.unshift(null),I.apply(null,b)):b}},v={},J=0,A=function(a){try{return v[a]?v[a]:(J++,v[a]=B(new q("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(c,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }")),
!0))}catch(b){return u(b),t}},w={},K=0,H=function(a){try{if(!w[a]){K++;var b=a.replace(c,"$1____.$3");return w[a]=B(new q("____","$$$$","$$interceptor","$$itself","".concat("try {",b," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return w[a]}catch(f){return u(f),t}},x={},L=0,G=function(a,d){var c;return(c=b(a))?c:A(a)(d)},y=function(){1E3<=J&&(v={});1E3<=K&&(w={});1E3<=L&&(x={})};g.create=l;g.unsubscribeAndDestroy=function(a,b,c,e){b=p(b);(a=a.$$watchers)&&
a[b]&&a[b].unsubscribeAndDestroy(c,e)&&delete a[b]};g.normalizeExpr=m;g.prepareCode=function(a){return a.replace(c,"$1____.$3")};g.createGetter=A;g.createSetter=H;g.createFunc=function(a){try{return x[a]?x[a]:(L++,x[a]=B(new q("____","$$interceptor","$$itself","".concat("try {",a.replace(c,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(b){return u(b),t}};g.eval=G;g.enableResetCacheInterval=function(){setTimeout(y,1E4)};return g}()});
