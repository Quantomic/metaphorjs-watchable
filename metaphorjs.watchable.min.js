(function(){"undefined"==typeof window&&(global.window=global);var p;if("undefined"!=typeof global)try{p=require("metaphorjs-observable")}catch(A){global.Observable&&(p=global.Observable)}else window.MetaphorJs&&MetaphorJs.lib&&MetaphorJs.lib.Promise&&(p=MetaphorJs.lib.Observable);var q=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,w={},x=window.MetaphorJs&&MetaphorJs.nextUid?MetaphorJs.nextUid:function(){var a;a=Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10);return w[a]?
x():w[a]=a},s=Object.prototype.toString,l=function(a){return"[object Array]"===s.call(a)},t=function(a){return"[object Date]"===s.call(a)},u=function(a){return"[object RegExp]"===s.call(a)},v=function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval},n=function(a,b){if(v(a))throw Error("Cannot copy window object");if(b){if(a===b)throw Error("Objects are identical");if(l(a))for(var c=b.length=0;c<a.length;c++)b.push(n(a[c]));else{for(c in b)delete b[c];for(c in a)b[c]=n(a[c])}}else(b=a)&&
(l(a)?b=n(a,[]):t(a)?b=new Date(a.getTime()):u(a)?b=new RegExp(a.source):null!=a&&"object"===typeof a&&(b=n(a,{})));return b},r=function(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var c=typeof a,e;if(c==typeof b&&"object"==c)if(l(a)){if(!l(b))return!1;if((c=a.length)==b.length){for(e=0;e<c;e++)if(!r(a[e],b[e]))return!1;return!0}}else{if(t(a))return t(b)&&a.getTime()==b.getTime();if(u(a)&&u(b))return a.toString()==b.toString();if(v(a)||v(b)||l(b))return!1;c={};for(e in a)if(("$"!==
e.charAt(0)||"object"!=typeof a[e])&&"function"!==typeof a[e]){if(!r(a[e],b[e]))return!1;c[e]=!0}for(e in b)if(!c.hasOwnProperty(e)&&"$"!==e.charAt(0)&&void 0!==b[e]&&"function"!==typeof b[e])return!1;return!0}return!1},y=function(a,b){var c=a.length,e=b.length,h=Array(c+1),m=Array(c+1),d,g,f,k,l=0;if(c==e&&0==c)return{changes:0,distance:0,prescription:[]};for(d=0;d<=c;d++)h[d]=Array(e+1),m[d]=Array(e+1),h[d][0]=d,m[d][0]="D";for(d=0;d<=e;d++)h[0][d]=d,m[0][d]="I";for(d=1;d<=c;d++)for(g=1;g<=e;g++)f=
r(a[d-1],b[g-1])?0:1,h[d][g-1]<h[d-1][g]&&h[d][g-1]<h[d-1][g-1]+f?(h[d][g]=h[d][g-1]+1,m[d][g]="I"):h[d-1][g]<h[d-1][g-1]+f?(h[d][g]=h[d-1][g]+1,m[d][g]="D"):(h[d][g]=h[d-1][g-1]+f,m[d][g]=1==f?"R":"-");k=[];d=c;g=e;do f=m[d][g],k.push(f),"-"!=f&&l++,"R"==f||"-"==f?(d--,g--):"D"==f?d--:g--;while(0!=d||0!=g);return{changes:l/k.length,distance:h[c][e],prescription:k.reverse()}},z=MetaphorJs?MetaphorJs.trim:function(){return String.prototype.trim?function(a){return"string"==typeof a?a.trim():a}:function(a){return"string"==
typeof a?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),k,f=function(a,b,c,e,h){k||(k=new p);var m=x(),d;l(a)&&"array"==b?d="array":("string"!=typeof b&&(e=c,c=b,b=null,d="object"),"string"==typeof a&&(e=c,c=b,b=a,a=null),b&&a&&(d=a.hasOwnProperty(b)?"attr":"expr"),b&&!a&&(d="expr"));if(c)k.on(m,c,e||this,{append:[h],allowDupes:!0});this.code=b;this.getterFn="expr"==d?f.createGetter(b):null;this.id=m;this.type=d;this.obj=a;this.itv=null;this.curr=this._getValue()};(function(a,b){for(var c in b)b.hasOwnProperty(c)&&
(a[c]=b[c])})(f.prototype,{code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,arraySlice:!1,_checkCode:function(){var a=this._getValue(),b=!1,c=this.curr;if(l(c)&&l(a))return b=y(c,a),b.changes?(this.curr=a.slice(),k.trigger(this.id,b,a,c),!0):!1;a!==c&&(this.curr=a,k.trigger(this.id,a,c),b=!0);return b},_checkObject:function(){var a=this.obj,b=this.curr;return r(b,a)?!1:(this.curr=n(a),k.trigger(this.id,a,b),!0)},_checkArray:function(){var a=this.curr,b=this.obj,
c=y(a,b);return c.changes?(this.curr=b.slice(),k.trigger(this.id,c,b,a),!0):!1},_getValue:function(){var a;switch(this.type){case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":return n(this.obj);case "array":return this.obj.slice()}return l(a)?a.slice():a},addListener:function(a,b,c){return k.on(this.id,a,b,c)},removeListener:function(a,b){return k.un(this.id,a,b)},getValue:function(){return this._getValue()},setValue:function(a){if("attr"==this.type)this.obj[this.code]=
a;else if("expr"==this.type)this.setterFn||(this.setterFn=f.createSetter(this.code)),this.setterFn(this.obj,a);else throw Error("Cannot set value");},check:function(){switch(this.type){case "expr":case "attr":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},
a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var c=this.id;k.un(c,a,b);return k.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){this.obj=this.curr=null;this.itv&&this.clearInterval();k.destroyEvent(this.id);this.obj&&delete this.obj.$$watchers[this.code]}});f.create=function(a,b,c,e,h){b=f.normalizeExpr(a,z(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?
b++:"$"==a.charAt(0)&&this[a]instanceof f&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof f)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].addListener(c,e,{append:[h],allowDupes:!0}):a.$$watchers[b]=new f(a,b,c,e,h),a.$$watchers[b]):new f(a,b,c,e,h)};f.unsubscribeAndDestroy=function(a,b,c,e){b=z(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,e)&&delete a[b]};f.normalizeExpr=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;
var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b};f.prepareCode=function(a){return a.replace(q,"$1____.$3")};f.createGetter=function(a){a=a.replace(q,"$1____.$3");return new Function("____","return "+a)};f.createSetter=function(a){a=a.replace(q,"$1____.$3");return new Function("____","$$$$",a+" = $$$$")};f.createFunc=function(a){a=a.replace(q,"$1____.$3");return new Function("____",a)};window.MetaphorJs&&MetaphorJs.r&&MetaphorJs.r("MetaphorJs.lib.Watchable",f);"undefined"!=
typeof global&&(module.exports=f)})();
